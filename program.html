<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK â€“ Dashboard Program</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .btn { transition: background-color 0.3s, transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { cursor: not-allowed; opacity: 0.6; transform: none; }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        #progress-circle { transition: stroke-dashoffset 0.5s ease-in-out; transform: rotate(-90deg); transform-origin: center; }
        @keyframes pulse-animation { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .logo-pulse { animation: pulse-animation 2s infinite; }
        @keyframes highlight-fade {
            from { background-color: #d1fae5; }
            to { background-color: white; }
        }
        .new-entry {
            animation: highlight-fade 2s ease-out;
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <header class="bg-white shadow-sm">
        <div class="max-w-screen-2xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4">
            <div class="flex items-center gap-3 self-start sm:self-center">
                <div class="bg-indigo-600 p-2 rounded-lg logo-pulse"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white"><path d="M4 4H8V8H4V4Z" fill="currentColor"></path><path d="M4 16H8V20H4V16Z" fill="currentColor"></path><path d="M16 4H20V8H16V4Z" fill="currentColor"></path><path d="M10 4H14V6H10V4Z" fill="currentColor"></path><path d="M10 8H12V10H10V8Z" fill="currentColor"></path><path d="M12 12H14V14H12V12Z" fill="currentColor"></path><path d="M10 16H12V18H10V16Z" fill="currentColor"></path><path d="M14 16H16V18H14V16Z" fill="currentColor"></path><path d="M16 12H18V14H16V12Z" fill="currentColor"></path><path d="M16 8H20V10H16V8Z" fill="currentColor"></path><path d="M12 18H14V20H12V18Z" fill="currentColor"></path><path d="M4 10H6V14H4V10Z" fill="currentColor"></path></svg></div>
                <div>
                    <h1 class="text-2xl font-bold text-indigo-600">SPARK</h1>
                    <p class="text-sm text-gray-500">Percikan Inovasi Kehadiran Digital</p>
                </div>
            </div>
            <div id="header-buttons" class="flex w-full sm:w-auto justify-center sm:justify-end items-center gap-2 sm:gap-4 flex-wrap">
                 <a href="index.html" class="btn bg-gray-100 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-200 flex items-center gap-2 text-xs sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414l-3-3z" clip-rule="evenodd" /></svg>Halaman Utama</a>
                 <button onclick="window.location.href='semak.html'" class="btn bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-700 flex items-center gap-2 text-xs sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h4a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>Jana Permohonan</button>
            </div>
        </div>
    </header>

    <main class="max-w-screen-2xl mx-auto py-6 sm:px-6 lg:px-8 flex-grow w-full">
        <div id="loading-dashboard" class="text-center p-8">
            <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <p class="mt-2 text-gray-600">Memuatkan dashboard program...</p>
        </div>

        <div id="full-dashboard-content" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                    <div class="card p-6">
                        <div class="flex justify-between items-start gap-4 mb-2">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>
                                    <p class="text-sm font-medium text-indigo-600 uppercase">Maklumat Program</p>
                                </div>
                                <h2 id="dashboard-program-name" class="text-2xl font-bold text-gray-800"></h2>
                            </div>
                            <div class="flex items-center gap-2">
                                <button onclick="shareCurrentProgramLink()" title="Kongsi" class="btn bg-gray-100 text-gray-700 p-2 rounded-lg border border-gray-300 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" /></svg></button>
                                <button onclick="printQrPage()" title="Cetak Halaman QR" class="btn bg-gray-100 text-gray-700 p-2 rounded-lg border border-gray-300 hover:bg-gray-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" /></svg></button>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4 flex flex-col md:flex-row flex-wrap gap-4">
                            <div class="flex items-center gap-3 text-gray-700 bg-gray-100 px-4 py-2 rounded-lg flex-1 min-w-[200px]"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg><span id="dashboard-location" class="font-semibold text-sm"></span></div>
                            <div class="flex items-center gap-3 text-gray-700 bg-gray-100 px-4 py-2 rounded-lg flex-1 min-w-[200px]"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg><span id="dashboard-date" class="font-semibold text-sm"></span></div>
                            <div class="flex items-center gap-3 text-indigo-800 bg-indigo-100 px-4 py-2 rounded-lg flex-1 min-w-[200px]"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg><span id="dashboard-time" class="font-semibold text-sm"></span></div>
                            <div id="dashboard-countdown" class="hidden items-center gap-3 text-red-800 bg-red-100 px-4 py-2 rounded-lg flex-1 min-w-[200px]"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg><span id="countdown-timer-text" class="font-semibold text-sm"></span></div>
                        </div>
                    </div>
                    <div id="manual-checkin-card" class="card p-6 hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>Daftar Masuk Manual</h3>
                        <div class="flex">
                            <input id="manual-ic-input" type="text" placeholder="Masukkan No. IC peserta" class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:ring-indigo-500 focus:border-indigo-500">
                            <button onclick="checkIn()" class="btn bg-indigo-600 text-white font-semibold px-6 py-2 rounded-r-md hover:bg-indigo-700">Sahkan</button>
                        </div>
                    </div>
                    <div class="card p-6">
                        <div class="flex flex-wrap justify-between items-center gap-y-2 mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500" viewBox="0 0 20 20" fill="currentColor"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" /></svg>Senarai Kehadiran</h3>
                            <div class="flex items-center gap-x-2 sm:gap-x-4">
                                <button id="manual-checkin-btn" onclick="toggleManualCheckin()" title="Daftar Peserta Secara Manual" class="btn bg-blue-100 text-blue-800 text-xs font-semibold py-1 px-3 rounded-lg hover:bg-blue-200">Daftar Manual</button>
                                <label for="attendance-per-page" class="text-sm font-medium text-gray-700">Papar:</label>
                                <select id="attendance-per-page" onchange="changeAttendancePerPage()" class="block w-24 pl-3 pr-8 py-1 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="30">30</option>
                                </select>
                                <button id="evaluation-btn" onclick="showEvaluationQrModal()" class="btn bg-yellow-100 text-yellow-800 text-xs font-semibold py-1 px-3 rounded-lg hover:bg-yellow-200 flex items-center gap-2 hidden">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                                    <span>Penilaian</span>
                                </button>
                                <button onclick="showUnlockModal()" class="btn bg-purple-100 text-purple-800 font-semibold px-4 py-1.5 rounded-md text-sm flex items-center gap-2 hover:bg-purple-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg>Administrator</button>
                            </div>
                        </div>
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-6"><a href="#" id="attendance-date" class="py-2 px-1 border-b-2 font-medium text-sm text-indigo-600 border-indigo-500"></a></nav>
                        </div>
                        <div class="mt-4 overflow-x-auto">
                            <table class="w-auto min-w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bil.</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Peserta</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Masa Hadir</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="attendance-list-body"></tbody>
                            </table>
                        </div>
                        <div id="attendance-pagination-controls" class="flex justify-between items-center mt-4"></div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div id="survey-summary-card" class="card p-6 hidden"></div>
                    <div class="card p-6"></div>
                    <div id="qr-card" class="card p-6 text-center flex flex-col items-center justify-center relative"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center py-4 mt-8 border-t border-gray-200"></footer>
    
    <div id="share-link-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"></div>
    <div id="new-participant-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"></div>
    <div id="unlock-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"></div>
    <div id="edit-program-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"></div>
    <div id="survey-list-modal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden"></div>
    <div id="fullscreen-qr-modal" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center p-4 hidden"></div>

    <div id="evaluation-fullscreen-qr-modal" class="fixed inset-0 z-50 bg-indigo-700 flex flex-col items-center justify-center p-4 hidden">
        <button onclick="closeEvaluationQrModal()" class="absolute top-6 right-6 text-white hover:text-indigo-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        <div class="text-center text-white mb-6">
            <h1 id="evaluation-fullscreen-title" class="text-4xl font-bold tracking-wider"></h1>
            <p id="evaluation-fullscreen-program-name" class="text-2xl font-semibold mt-2"></p>
            <p id="evaluation-fullscreen-details" class="text-lg mt-2"></p>
        </div>
        <div class="bg-white p-4 rounded-lg">
            <img id="evaluation-fullscreen-qr-image" src="" alt="QR Code Penilaian Program">
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove, collection, query, where, onSnapshot, addDoc, getDocs, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ... Firebase Config ...
        const firebaseConfig = { apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM", authDomain: "myqrhadir.firebaseapp.com", projectId: "myqrhadir", storageBucket: "myqrhadir.appspot.com", messagingSenderId: "799691133747", appId: "1:799691133747:web:835a5e3e9413eace806446" };
        
        // ... Variable initializations ...
        let db, auth, userId, currentLoadedProgram = null, unsubscribeProgramListener = null;

        try { const app = initializeApp(firebaseConfig); db = getFirestore(app); auth = getAuth(app); } catch (e) { console.error("Error initializing Firebase:", e); }
        
        onAuthStateChanged(auth, async (user) => {
            if (user) { userId = user.uid; main(); } 
            else { try { await signInAnonymously(auth); } catch (error) { console.error("Error signing in:", error); } }
        });

        function main() { 
            // ... main logic from previous version ...
        }
        
        function initializeDashboard(programKey) {
            // ... (rest of the function from previous version) ...
            unsubscribeProgramListener = onSnapshot(programRef, (docSnap) => {
                if (docSnap.exists()) {
                    currentLoadedProgram = { id: docSnap.id, ...docSnap.data() };
                    
                    // ... (setting program name, date, etc.) ...

                    // Handle Evaluation Button visibility
                    const evalBtn = document.getElementById('evaluation-btn');
                    if (currentLoadedProgram.evaluationNeeded && currentLoadedProgram.evaluationKey) {
                        evalBtn.classList.remove('hidden');
                    } else {
                        evalBtn.classList.add('hidden');
                    }
                    
                    // ... (rest of the logic: startCountdown, renderAttendanceTable, etc.) ...
                } 
                // ... (else block for program not found) ...
            });
        }
        
        function startCountdown(programData) {
            // ... (rest of the function from previous version) ...
            const manualCheckinBtn = document.getElementById('manual-checkin-btn');
            
            if (!programData.expiryTimestamp) { 
                // ... logic to enable manual button if no expiry ...
                if(manualCheckinBtn) {
                    manualCheckinBtn.disabled = false;
                    manualCheckinBtn.title = "Daftar Peserta Secara Manual";
                    manualCheckinBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                return;
            }

            // ... (interval logic) ...
            window.countdownTimerInterval = setInterval(() => {
                const distance = new Date(programData.expiryTimestamp) - new Date().getTime();
                if (distance < 0) {
                    // ... (logic to show "Pendaftaran Ditutup") ...
                    if(manualCheckinBtn) {
                        manualCheckinBtn.disabled = true;
                        manualCheckinBtn.title = "Pendaftaran telah ditutup";
                        manualCheckinBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                    return;
                }
                // ... (logic to enable button and show countdown) ...
                if(manualCheckinBtn) {
                    manualCheckinBtn.disabled = false;
                    manualCheckinBtn.title = "Daftar Peserta Secara Manual";
                    manualCheckinBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }, 1000);
        }

        // --- NEW FUNCTIONS FOR EVALUATION QR MODAL ---
        function showEvaluationQrModal() {
            if (!currentLoadedProgram || !currentLoadedProgram.evaluationKey) return;
            
            const modal = document.getElementById('evaluation-fullscreen-qr-modal');
            const titleEl = document.getElementById('evaluation-fullscreen-title');
            const programNameEl = document.getElementById('evaluation-fullscreen-program-name');
            const detailsEl = document.getElementById('evaluation-fullscreen-details');
            const qrImg = document.getElementById('evaluation-fullscreen-qr-image');

            const evalUrl = `${window.location.origin}${window.location.pathname.replace('program.html', 'penilaianprogram.html')}?kod=${currentLoadedProgram.evaluationKey}`;
            const detailsText = `${currentLoadedProgram.location} | ${formatDateRange(currentLoadedProgram.startDate, currentLoadedProgram.endDate)} | ${formatTimeRange(currentLoadedProgram.startTime, currentLoadedProgram.endTime)}`;

            titleEl.textContent = 'PENILAIAN PROGRAM';
            programNameEl.textContent = currentLoadedProgram.name.toUpperCase();
            detailsEl.textContent = detailsText.toUpperCase();
            
            const qrSize = Math.min(window.innerWidth, window.innerHeight) * 0.5;
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=${Math.floor(qrSize)}x${Math.floor(qrSize)}&data=${encodeURIComponent(evalUrl)}`;
            
            modal.classList.remove('hidden');
        }

        function closeEvaluationQrModal() {
            document.getElementById('evaluation-fullscreen-qr-modal').classList.add('hidden');
        }

        // --- ALL OTHER JS FUNCTIONS (checkIn, tables, modals, etc.) remain the same ---

        Object.assign(window, { 
            // ... (all previous functions) ...
            showEvaluationQrModal, 
            closeEvaluationQrModal 
        });
    </script>
</body>
</html>
