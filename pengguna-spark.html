<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kajian Impak Inovasi SPARK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .likert-scale input[type="radio"] { display: none; }
        .likert-scale label {
            display: block; padding: 10px; text-align: center; border: 1px solid #cbd5e1;
            cursor: pointer; transition: all 0.2s; font-size: 0.8rem; font-weight: 600;
        }
        .likert-scale label:hover { background-color: #f8fafc; }
        .likert-scale input[type="radio"]:checked + label {
            background-color: #0f172a; color: white; border-color: #0f172a;
        }
        .likert-scale div:first-child label { border-radius: 8px 0 0 8px; }
        .likert-scale div:last-child label { border-radius: 0 8px 8px 0; }
        
        .tab-active { background-color: #0f172a; color: white; border-color: #0f172a; }
        .tab-inactive { background-color: white; color: #64748b; border-color: #cbd5e1; }
    </style>
</head>
<body class="text-slate-800 min-h-screen py-10 px-4 flex justify-center">

    <div class="w-full max-w-4xl bg-white shadow-2xl rounded-2xl overflow-hidden border border-slate-200">
        
        <div class="bg-slate-900 p-8 text-center text-white">
            <h1 class="text-2xl md:text-3xl font-extrabold uppercase tracking-widest text-amber-400">Kajian Impak Inovasi</h1>
            <h2 class="text-xl font-bold mt-1">Sistem Pengurusan Kehadiran (SPARK)</h2>
            <p class="text-slate-400 text-xs mt-3 max-w-2xl mx-auto leading-relaxed">
                Kajian ini bertujuan mengukur keberkesanan SPARK berbanding kaedah konvensional (Manual/Google Form) dari aspek penjimatan masa, kos, dan kecekapan operasi. Data ini akan digunakan untuk pertandingan inovasi peringkat PPD/Negeri.
            </p>
        </div>

        <form id="surveyForm" onsubmit="submitSurvey(event)" class="p-6 md:p-10 space-y-12">

            <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                <div class="flex items-center gap-3 mb-6">
                    <span class="bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-full">BAHAGIAN A</span>
                    <h3 class="text-lg font-bold text-slate-800 uppercase">Profil Responden</h3>
                </div>

                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">1. No. Kad Pengenalan (Untuk Pengesahan Data)</label>
                        <div class="flex gap-2">
                            <input type="tel" id="ic_input" maxlength="12" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-slate-500 outline-none font-mono tracking-widest" placeholder="Contoh: 880101131234" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            <button type="button" onclick="verifyIC()" id="btn-verify" class="bg-blue-600 text-white px-6 rounded-lg text-xs font-bold hover:bg-blue-700 transition uppercase shadow-lg">Semak Data</button>
                        </div>
                        <p id="verify-msg" class="text-xs mt-2 font-medium text-slate-500 italic">Sila masukkan No. IC dan tekan 'Semak Data' untuk mengisi maklumat secara automatik.</p>
                    </div>

                    <div id="category-section" class="opacity-50 pointer-events-none transition-all duration-300">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">2. Kategori Pengguna</label>
                        <div class="grid grid-cols-3 gap-0">
                            <button type="button" onclick="selectCategory('warga')" id="tab-warga" class="tab-active py-3 text-xs font-bold uppercase rounded-l-lg border transition">Warga Pendidikan</button>
                            <button type="button" onclick="selectCategory('murid')" id="tab-murid" class="tab-inactive py-3 text-xs font-bold uppercase border-t border-b border-r transition">Murid / Pelajar</button>
                            <button type="button" onclick="selectCategory('awam')" id="tab-awam" class="tab-inactive py-3 text-xs font-bold uppercase rounded-r-lg border-t border-b border-r transition">Orang Awam</button>
                        </div>
                        <input type="hidden" id="category" value="warga">

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nama Penuh</label>
                                <input type="text" id="name" class="w-full p-2.5 bg-white border border-slate-300 rounded-lg text-sm uppercase font-semibold text-slate-700" readonly>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Jantina</label>
                                <div class="flex gap-4">
                                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="gender" value="Lelaki" class="w-4 h-4 text-slate-800"> <span class="text-sm font-medium">Lelaki</span></label>
                                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="gender" value="Perempuan" class="w-4 h-4 text-slate-800"> <span class="text-sm font-medium">Perempuan</span></label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Jawatan</label>
                                <input type="text" id="position" class="w-full p-2.5 bg-white border border-slate-300 rounded-lg text-sm uppercase font-semibold text-slate-700">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Stesen / Sekolah</label>
                                <input type="text" id="station" class="w-full p-2.5 bg-white border border-slate-300 rounded-lg text-sm uppercase font-semibold text-slate-700">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100">
                <div class="flex items-center gap-3 mb-6">
                    <span class="bg-indigo-600 text-white text-xs font-bold px-3 py-1 rounded-full">BAHAGIAN B</span>
                    <h3 class="text-lg font-bold text-indigo-900 uppercase">Analisis Perbandingan Masa (ROI)</h3>
                </div>
                <p class="text-sm text-indigo-800 mb-6 italic bg-white p-3 rounded border border-indigo-100">
                    Bahagian ini penting untuk mengira <b>Peratus Penjimatan Masa</b>. Sila berikan anggaran masa dalam <b>SAAT</b> untuk satu transaksi pendaftaran.
                </p>

                <div class="space-y-8">
                    <div>
                        <label class="block text-sm font-bold text-gray-800 mb-2">3. Berapa SAAT masa diambil untuk mendaftar secara <u>MANUAL</u>? (Cari nama, tulis tangan, tanda tangan)</label>
                        <div class="grid grid-cols-4 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="time_manual" value="30" class="peer sr-only" required>
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-red-500 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">30 Saat<br>(Pantas)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_manual" value="60" class="peer sr-only" checked>
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-red-500 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">60 Saat<br>(1 Minit)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_manual" value="120" class="peer sr-only">
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-red-500 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">120 Saat<br>(2 Minit)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_manual" value="300" class="peer sr-only">
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-red-500 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">300 Saat<br>(Beratur)</div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-800 mb-2">4. Berapa SAAT masa diambil untuk mendaftar menggunakan <u>SPARK</u>? (Scan QR & Auto-Simpan)</label>
                        <div class="grid grid-cols-4 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="time_spark" value="3" class="peer sr-only" required>
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-green-600 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">3 Saat<br>(Kilat)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_spark" value="5" class="peer sr-only" checked>
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-green-600 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">5 Saat<br>(Laju)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_spark" value="10" class="peer sr-only">
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-green-600 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">10 Saat<br>(Sederhana)</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_spark" value="20" class="peer sr-only">
                                <div class="p-3 text-center border rounded-lg peer-checked:bg-green-600 peer-checked:text-white bg-white hover:bg-gray-50 text-xs font-bold">20 Saat<br>(Line Slow)</div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="flex items-center gap-3 mb-6 border-b pb-4">
                    <span class="bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-full">BAHAGIAN C</span>
                    <h3 class="text-lg font-bold text-slate-800 uppercase">Analisis Masalah & Penyelesaian</h3>
                </div>
                
                <div class="space-y-10">
                    
                    <div>
                        <div class="bg-red-50 border-l-4 border-red-500 p-3 mb-3">
                            <p class="text-xs font-bold text-red-600 uppercase">Masalah (Pain Point):</p>
                            <p class="text-sm text-gray-700">"Guru/Pegawai terbeban mengisi DUA borang (Tinjauan Kehadiran & Pendaftaran Hari Kejadian) yang berasingan dan berulang."</p>
                        </div>
                        <p class="text-sm font-bold text-gray-800 mb-2">5. Adakah anda bersetuju <span class="text-blue-600">Sistem Aliran Kerja Tunggal</span> dalam SPARK berjaya menghapuskan beban kerja berganda ini?</p>
                        <div class="likert-scale flex w-full">
                            <div class="flex-1"><input type="radio" name="q5" id="q5_1" value="1"><label for="q5_1">1</label></div>
                            <div class="flex-1"><input type="radio" name="q5" id="q5_2" value="2"><label for="q5_2">2</label></div>
                            <div class="flex-1"><input type="radio" name="q5" id="q5_3" value="3"><label for="q5_3">3</label></div>
                            <div class="flex-1"><input type="radio" name="q5" id="q5_4" value="4"><label for="q5_4">4</label></div>
                            <div class="flex-1"><input type="radio" name="q5" id="q5_5" value="5"><label for="q5_5">5</label></div>
                        </div>
                        <div class="flex justify-between text-[10px] text-gray-400 mt-1"><span>Sangat Tidak Setuju</span><span>Sangat Setuju</span></div>
                    </div>

                    <div>
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 mb-3">
                            <p class="text-xs font-bold text-yellow-600 uppercase">Masalah (Pain Point):</p>
                            <p class="text-sm text-gray-700">"Berlaku kesilapan ejaan nama, salah nombor IC, atau tulisan tangan sukar dibaca menyebabkan data tidak tepat."</p>
                        </div>
                        <p class="text-sm font-bold text-gray-800 mb-2">6. Adakah ciri <span class="text-blue-600">Auto-Data (Pangkalan Data Berpusat)</span> SPARK menjamin ketepatan data kehadiran 100%?</p>
                        <div class="likert-scale flex w-full">
                            <div class="flex-1"><input type="radio" name="q6" id="q6_1" value="1"><label for="q6_1">1</label></div>
                            <div class="flex-1"><input type="radio" name="q6" id="q6_2" value="2"><label for="q6_2">2</label></div>
                            <div class="flex-1"><input type="radio" name="q6" id="q6_3" value="3"><label for="q6_3">3</label></div>
                            <div class="flex-1"><input type="radio" name="q6" id="q6_4" value="4"><label for="q6_4">4</label></div>
                            <div class="flex-1"><input type="radio" name="q6" id="q6_5" value="5"><label for="q6_5">5</label></div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-3 mb-3">
                            <p class="text-xs font-bold text-blue-600 uppercase">Masalah (Pain Point):</p>
                            <p class="text-sm text-gray-700">"Admin mengambil masa lama (berjam-jam) untuk menaip semula kehadiran dan menganalisis data untuk laporan."</p>
                        </div>
                        <p class="text-sm font-bold text-gray-800 mb-2">7. Adakah penjanaan <span class="text-blue-600">Laporan OPR Automatik</span> dalam SPARK mempercepatkan proses dokumentasi program?</p>
                        <div class="likert-scale flex w-full">
                            <div class="flex-1"><input type="radio" name="q7" id="q7_1" value="1"><label for="q7_1">1</label></div>
                            <div class="flex-1"><input type="radio" name="q7" id="q7_2" value="2"><label for="q7_2">2</label></div>
                            <div class="flex-1"><input type="radio" name="q7" id="q7_3" value="3"><label for="q7_3">3</label></div>
                            <div class="flex-1"><input type="radio" name="q7" id="q7_4" value="4"><label for="q7_4">4</label></div>
                            <div class="flex-1"><input type="radio" name="q7" id="q7_5" value="5"><label for="q7_5">5</label></div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-green-50 border-l-4 border-green-500 p-3 mb-3">
                            <p class="text-xs font-bold text-green-600 uppercase">Masalah (Pain Point):</p>
                            <p class="text-sm text-gray-700">"Penggunaan kertas yang banyak, kos percetakan, dan penyimpanan fail fizikal yang memakan ruang."</p>
                        </div>
                        <p class="text-sm font-bold text-gray-800 mb-2">8. Adakah anda bersetuju SPARK menyokong inisiatif <span class="text-blue-600">Go Green (Tanpa Kertas)</span> dan menjimatkan kos operasi?</p>
                        <div class="likert-scale flex w-full">
                            <div class="flex-1"><input type="radio" name="q8" id="q8_1" value="1"><label for="q8_1">1</label></div>
                            <div class="flex-1"><input type="radio" name="q8" id="q8_2" value="2"><label for="q8_2">2</label></div>
                            <div class="flex-1"><input type="radio" name="q8" id="q8_3" value="3"><label for="q8_3">3</label></div>
                            <div class="flex-1"><input type="radio" name="q8" id="q8_4" value="4"><label for="q8_4">4</label></div>
                            <div class="flex-1"><input type="radio" name="q8" id="q8_5" value="5"><label for="q8_5">5</label></div>
                        </div>
                    </div>

                    <div>
                        <p class="text-sm font-bold text-gray-800 mb-2">9. Secara keseluruhan, adakah sistem SPARK memberi <span class="text-blue-600">Kelebihan Kompetitif</span> berbanding Google Form?</p>
                        <div class="likert-scale flex w-full">
                            <div class="flex-1"><input type="radio" name="q9" id="q9_1" value="1"><label for="q9_1">1</label></div>
                            <div class="flex-1"><input type="radio" name="q9" id="q9_2" value="2"><label for="q9_2">2</label></div>
                            <div class="flex-1"><input type="radio" name="q9" id="q9_3" value="3"><label for="q9_3">3</label></div>
                            <div class="flex-1"><input type="radio" name="q9" id="q9_4" value="4"><label for="q9_4">4</label></div>
                            <div class="flex-1"><input type="radio" name="q9" id="q9_5" value="5"><label for="q9_5">5</label></div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="bg-white p-6 rounded-xl border border-slate-200">
                <div class="flex items-center gap-3 mb-6">
                    <span class="bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-full">BAHAGIAN D</span>
                    <h3 class="text-lg font-bold text-slate-800 uppercase">Ulasan & Cadangan</h3>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">10. Apakah SATU ciri utama SPARK yang paling membantu anda?</label>
                        <input type="text" id="feature" class="w-full p-3 border border-slate-300 rounded-lg text-sm" placeholder="Contoh: Sijil Automatik / OPR / Kelajuan...">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">11. Testimoni/Komen Padu (Untuk Juri)</label>
                        <textarea id="comment" rows="3" class="w-full p-3 border border-slate-300 rounded-lg text-sm bg-slate-50 focus:ring-2 focus:ring-blue-500" placeholder="Contoh: SPARK adalah transformasi digital sebenar yang kami nantikan..." required></textarea>
                    </div>
                </div>
            </div>

            <button type="submit" id="btnSubmit" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-black transition transform active:scale-95 uppercase tracking-wide text-sm opacity-50 cursor-not-allowed" disabled>
                Lengkapkan Bahagian A Dahulu
            </button>

        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM",
            authDomain: "myqrhadir.firebaseapp.com",
            projectId: "myqrhadir",
            storageBucket: "myqrhadir.appspot.com",
            messagingSenderId: "799691133747",
            appId: "1:799691133747:web:835a5e3e9413eace806446"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- TAB CATEGORY ---
        window.selectCategory = function(cat) {
            ['warga', 'murid', 'awam'].forEach(c => {
                const btn = document.getElementById(`tab-${c}`);
                if (c === cat) {
                    btn.classList.add('tab-active');
                    btn.classList.remove('tab-inactive');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('tab-inactive');
                }
            });
            document.getElementById('category').value = cat;
        }

        // --- VERIFY IC ---
        window.verifyIC = async function() {
            const icInput = document.getElementById('ic_input').value.trim();
            const btn = document.getElementById('btn-verify');
            const msg = document.getElementById('verify-msg');
            const catSection = document.getElementById('category-section');
            const submitBtn = document.getElementById('btnSubmit');

            if (icInput.length !== 12) {
                alert("Sila masukkan 12 digit nombor kad pengenalan.");
                return;
            }

            btn.textContent = "...";
            btn.disabled = true;

            try {
                const q = query(collection(db, "artifacts/myqrhadir/public/data/spark_participants"), where("ic", "==", icInput));
                const querySnapshot = await getDocs(q);

                // Buka Kunci
                catSection.classList.remove('opacity-50', 'pointer-events-none');
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-slate-800');
                submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                submitBtn.textContent = "HANTAR DATA KAJIAN";

                if (!querySnapshot.empty) {
                    const data = querySnapshot.docs[0].data();
                    document.getElementById('name').value = data.name || '';
                    document.getElementById('position').value = data.position || '';
                    document.getElementById('station').value = data.station || data.org || '';
                    msg.innerHTML = `<span class="text-green-600 font-bold">âœ“ Rekod Dijumpai.</span>`;
                } else {
                    msg.innerHTML = `<span class="text-orange-600 font-bold">! Pengguna Baru.</span> Sila isi maklumat manual.`;
                    document.getElementById('name').value = '';
                    document.getElementById('name').removeAttribute('readonly'); // Allow manual entry
                }

            } catch (error) {
                console.error(error);
                alert("Ralat sambungan.");
            } finally {
                btn.textContent = "SEMAK";
                btn.disabled = false;
            }
        }

        // --- SUBMIT ---
        window.submitSurvey = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.textContent = "MENGHANTAR...";
            btn.disabled = true;

            const getRadioVal = (name) => {
                const el = document.querySelector(`input[name="${name}"]:checked`);
                return el ? parseInt(el.value) : 0;
            };
            
            const genderEl = document.querySelector(`input[name="gender"]:checked`);

            const data = {
                ic: document.getElementById('ic_input').value,
                category: document.getElementById('category').value,
                name: document.getElementById('name').value,
                gender: genderEl ? genderEl.value : '-',
                position: document.getElementById('position').value,
                station: document.getElementById('station').value,
                
                // Time (Quantitative)
                timeManual: getRadioVal('time_manual'),
                timeSpark: getRadioVal('time_spark'),
                timeSaved: getRadioVal('time_manual') - getRadioVal('time_spark'), // Auto Calculate Gap

                // Qualitative Ratings (1-5)
                ratingBurden: getRadioVal('q5'),
                ratingData: getRadioVal('q6'),
                ratingReport: getRadioVal('q7'),
                ratingEco: getRadioVal('q8'),
                ratingOverall: getRadioVal('q9'),

                // Text
                feature: document.getElementById('feature').value,
                comment: document.getElementById('comment').value,
                
                timestamp: serverTimestamp()
            };

            try {
                await addDoc(collection(db, "spark_feedback_v4"), data); // V4 Collection
                alert("Data berjaya direkodkan! Terima kasih menyokong inovasi ini.");
                window.location.href = 'kata-pengguna.html'; 
            } catch (error) {
                console.error("Error:", error);
                alert("Gagal menghantar.");
                btn.textContent = "CUBA LAGI";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
