<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tadarus Bulan Ramadhan, PPD Miri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, where, onSnapshot, updateDoc, arrayUnion, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Data Constants ---
        const juzukNames = [
            "Alif Lam Mim", "Sayaqulu", "Tilka Rusul", "Lan Tanalu", "Wal Muhsanat", 
            "La Yuhibbullah", "Wa Iza Samiu", "Wa Lau Annana", "Qalal Malao", "Wa A'lamu",
            "Ya'tazeruna", "Wa Ma Min Dabbah", "Wa Ma Ubarri'u", "Rubama", "Subhanallazi",
            "Qala Alam", "Iqtaraba", "Qad Aflaha", "Wa Qalallazina", "Amman Khalaqa",
            "Utlu Ma Uhiya", "Wa Man Yaqnut", "Wa Maliya", "Faman Azlamu", "Ilaihi Yuraddu",
            "Ha Mim", "Qala Fama Khatbukum", "Qad Sami'allah", "Tabarakallazi", "'Amma Yatasa'alun"
        ];

        const juzukVersesCount = [
            148, 111, 126, 131, 124, 110, 149, 142, 159, 127,
            151, 170, 154, 227, 185, 269, 190, 202, 339, 171,
            178, 169, 357, 175, 246, 195, 399, 137, 431, 564
        ];

        // --- Configuration & Safety Check ---
        const userFirebaseConfig = {
            apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM",
            authDomain: "myqrhadir.firebaseapp.com",
            projectId: "myqrhadir",
            storageBucket: "myqrhadir.firebasestorage.app",
            messagingSenderId: "799691133747",
            appId: "1:799691133747:web:835a5e3e9413eace806446"
        };

        // PENTING: KITA PAKSA GUNA 'myqrhadir'
        let artifactAppId = 'myqrhadir';   
        
        let app, auth, db;
        let isOnlineMode = false;

        try {
            app = initializeApp(userFirebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            isOnlineMode = true;
            console.log("Firebase initialized. Target App ID:", artifactAppId);
        } catch (e) {
            console.warn("Error initializing Firebase. Switching to Offline Mode.", e);
        }

        // --- State Management ---
        let currentUser = null;
        let juzukData = {}; 
        let currentJuzukSelection = null; 

        // --- Init Logic ---
        async function initApp() {
            if (isOnlineMode) {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        initFirestoreListeners();
                        document.getElementById('modeIndicator').innerHTML = '<span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-[10px] font-bold border border-green-200"><i class="fas fa-cloud"></i> Online</span>';
                    }
                });
            } else {
                loadFromLocalStorage();
                document.getElementById('modeIndicator').innerHTML = '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-[10px] font-bold border border-gray-300"><i class="fas fa-save"></i> Local Mode</span>';
                document.getElementById('juzukContainer').innerHTML = '';
                renderList();
            }
        }

        initApp();

        // --- Data Handling ---
        function initFirestoreListeners() {
            const dataRef = collection(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data');
            onSnapshot(dataRef, (snapshot) => {
                const newData = {};
                snapshot.forEach(doc => {
                    newData[doc.id] = doc.data();
                });
                juzukData = newData;
                renderList();
            }, (error) => {
                console.error("Error fetching data:", error);
            });
        }

        function loadFromLocalStorage() {
            const stored = localStorage.getItem('tadarus_data_v2');
            if (stored) juzukData = JSON.parse(stored);
        }

        function saveToLocalStorage() {
            localStorage.setItem('tadarus_data_v2', JSON.stringify(juzukData));
            renderList();
        }

        // --- Global Functions ---
        window.openRegistrationModal = openRegistrationModal;
        window.checkIC = checkIC;
        window.confirmRegistration = confirmRegistration;
        window.toggleStatus = toggleStatus;
        window.removeParticipant = removeParticipant;
        window.copyToWhatsapp = copyToWhatsapp;
        window.closeModal = closeModal;
        window.clearAllData = clearAllData;

        // --- Calculator Logic ---
        function getDaysRemaining() {
            const targetDate = new Date("2026-03-06");
            const today = new Date();
            today.setHours(0,0,0,0);
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            return diffDays > 0 ? diffDays : 0;
        }

        // --- SPARK Logic: Check IC (Fixed: Sequential Query Search) ---
        async function checkIC() {
            let icRaw = document.getElementById('modalIC').value.trim();
            // Buang semua kecuali nombor dan huruf (untuk handle sengkang)
            const icClean = icRaw.replace(/[^0-9a-zA-Z]/g, '');

            const feedbackArea = document.getElementById('icFeedback');
            const nameInputContainer = document.getElementById('nameInputContainer');
            const nameInput = document.getElementById('modalName');
            const submitBtn = document.getElementById('submitBtn');

            if (icClean.length < 6) {
                feedbackArea.innerHTML = `<span class="text-red-500 text-xs">Sila masukkan No. IC yang sah (min 6 digit).</span>`;
                return;
            }

            feedbackArea.innerHTML = `<span class="text-gray-500 text-xs"><i class="fas fa-circle-notch fa-spin"></i> Sedang menyemak pangkalan data...</span>`;
            console.log(`Checking IC: ${icClean} (Raw: ${icRaw}) in ${artifactAppId}`);
            
            if (isOnlineMode) {
                let foundRecord = null;
                let foundSource = "";

                try {
                    // --- 1. Cari dalam 'tadarus_users' (Database Tadarus Sendiri) ---
                    // Keutamaan tinggi: Jika pernah daftar tadarus sebelum ini
                    const tadarusRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_users', icClean);
                    const tadarusSnap = await getDoc(tadarusRef);
                    
                    if (tadarusSnap.exists()) {
                        foundRecord = tadarusSnap.data();
                        foundSource = "Rekod Tadarus";
                    }

                    // --- 2. Cari dalam 'spark_participants' (Peserta SPARK Umum) ---
                    // Jika tiada dalam Tadarus, cari dalam database utama SPARK
                    if (!foundRecord) {
                        const participantsRef = collection(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_participants');
                        // Guna Query 'where' sebab ID mungkin rawak (auto-generated)
                        const q = query(participantsRef, where("ic", "==", icClean), limit(1));
                        const querySnap = await getDocs(q);
                        
                        if (!querySnap.empty) {
                            foundRecord = querySnap.docs[0].data();
                            foundSource = "Rekod SPARK (Peserta)";
                        } else if (icRaw !== icClean) {
                            // Cuba cari dengan IC yang ada sengkang jika database lama simpan format sengkang
                            const qRaw = query(participantsRef, where("ic", "==", icRaw), limit(1));
                            const querySnapRaw = await getDocs(qRaw);
                            if (!querySnapRaw.empty) {
                                foundRecord = querySnapRaw.docs[0].data();
                                foundSource = "Rekod SPARK (Peserta)";
                            }
                        }
                    }

                    // --- 3. Cari dalam 'spark_school_auth' (Guru & AKP) ---
                    // Database ini untuk warga sekolah
                    if (!foundRecord) {
                        const schoolAuthRef = collection(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_school_auth');
                        const qSchool = query(schoolAuthRef, where("ic", "==", icClean), limit(1));
                        const schoolSnap = await getDocs(qSchool);

                        if (!schoolSnap.empty) {
                            foundRecord = schoolSnap.docs[0].data();
                            foundSource = "Rekod Sekolah (Guru/AKP)";
                        } else {
                            // Fallback: Cuba cari direct by ID jika query gagal
                            try {
                                const docSnap = await getDoc(doc(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_school_auth', icClean));
                                if (docSnap.exists()) {
                                    foundRecord = docSnap.data();
                                    foundSource = "Rekod Sekolah (Guru/AKP)";
                                }
                            } catch(err) { console.log("Direct doc check skipped"); }
                        }
                    }

                    // --- 4. Cari dalam 'spark_ppd_officers' (Pegawai PPD) ---
                    if (!foundRecord) {
                        const officersRef = collection(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_ppd_officers');
                        const qOfficer = query(officersRef, where("ic", "==", icClean), limit(1));
                        const officerSnap = await getDocs(qOfficer);

                        if (!officerSnap.empty) {
                            foundRecord = officerSnap.docs[0].data();
                            foundSource = "Rekod Pegawai PPD";
                        }
                    }

                    // --- HASIL CARIAN ---
                    if (foundRecord) {
                        // Kenalpasti medan nama yang betul (kadang-kadang berbeza ikut database)
                        const fullName = foundRecord.name || foundRecord.nama || foundRecord.full_name || foundRecord.Nama || "";
                        
                        if (fullName) {
                            nameInput.value = fullName;
                            nameInput.disabled = true; // Kunci supaya tak perlu taip
                            nameInputContainer.classList.remove('hidden');
                            feedbackArea.innerHTML = `<span class="text-green-600 text-xs font-bold flex items-center gap-1"><i class="fas fa-check-circle"></i> ${foundSource} dijumpai!<br>Nama: ${fullName}</span>`;
                            submitBtn.disabled = false;
                            submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        } else {
                            // Rekod jumpa tapi medan nama kosong
                            promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);
                        }
                    } else {
                        // Memang tiada rekod langsung
                        console.log("No record found anywhere.");
                        promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);
                    }

                } catch (e) {
                    console.error("Search Error:", e);
                    feedbackArea.innerHTML = `<span class="text-red-500 text-xs">Ralat sambungan: ${e.message}</span>`;
                }
            } else {
                // Offline Logic (Cari dalam list tadarus semasa sahaja)
                let foundName = null;
                Object.values(juzukData).forEach(juz => {
                    if (juz.participants) {
                        const p = juz.participants.find(p => p.ic === icClean || p.ic === icRaw);
                        if (p) foundName = p.name;
                    }
                });

                if (foundName) {
                    nameInput.value = foundName;
                    nameInput.disabled = true;
                    nameInputContainer.classList.remove('hidden');
                    feedbackArea.innerHTML = `<span class="text-green-600 text-xs font-bold"><i class="fas fa-check-circle"></i> Rekod Lokal ditemui: ${foundName}</span>`;
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);
                }
            }
        }

        function promptNewUser(nameInput, container, feedback, btn) {
            nameInput.value = '';
            nameInput.disabled = false;
            container.classList.remove('hidden');
            feedback.innerHTML = `<span class="text-amber-600 text-xs font-bold flex items-center gap-1"><i class="fas fa-info-circle"></i> Peserta Baru. Sila taip nama.</span>`;
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            setTimeout(() => document.getElementById('modalName').focus(), 100);
        }

        // --- Logic: Confirm Registration ---
        async function confirmRegistration() {
            const icRaw = document.getElementById('modalIC').value.trim();
            const ic = icRaw.replace(/[^0-9a-zA-Z]/g, ''); // Simpan format bersih
            const name = document.getElementById('modalName').value.trim();
            const juzukId = currentJuzukSelection.toString();
            
            if (!name || !ic) return;

            const submitBtn = document.getElementById('submitBtn');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ...';
            submitBtn.disabled = true;

            const newParticipant = {
                ic: ic,
                name: name,
                status: 'reading',
                timestamp: Date.now()
            };

            if (isOnlineMode) {
                try {
                    // 1. Simpan ke Database Baru (tadarus_users) supaya lain kali dia ingat
                    const userRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_users', ic);
                    await setDoc(userRef, { 
                        name: name, 
                        ic: ic, 
                        last_updated: new Date().toISOString(),
                        source: 'tadarus_registration'
                    }, { merge: true });

                    // 2. Simpan ke Senarai Juzuk (tadarus_data)
                    const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukId);
                    await setDoc(juzukRef, {
                        participants: arrayUnion(newParticipant),
                        juzuk_id: parseInt(juzukId)
                    }, { merge: true });

                    closeModal();
                    showToast(`Berjaya daftar: ${name}`);
                } catch (e) {
                    console.error("Save error:", e);
                    alert("Gagal menyimpan. Sila semak sambungan internet.");
                }
            } else {
                // Offline Save
                if (!juzukData[juzukId]) juzukData[juzukId] = { participants: [] };
                if (!juzukData[juzukId].participants) juzukData[juzukId].participants = [];
                
                juzukData[juzukId].participants.push(newParticipant);
                saveToLocalStorage();
                closeModal();
                showToast(`Disimpan (Lokal): ${name}`);
            }
            
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
        }

        async function toggleStatus(juzukId, ic, currentStatus) {
            const juzukStr = juzukId.toString();
            const newStatus = currentStatus === 'done' ? 'reading' : 'done';

            if (isOnlineMode) {
                const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukStr);
                try {
                    const docSnap = await getDoc(juzukRef);
                    if (docSnap.exists()) {
                        let participants = docSnap.data().participants || [];
                        const updatedParticipants = participants.map(p => {
                            if (p.ic === ic) return { ...p, status: newStatus };
                            return p;
                        });
                        await updateDoc(juzukRef, { participants: updatedParticipants });
                    }
                } catch (e) { console.error(e); }
            } else {
                if (juzukData[juzukStr] && juzukData[juzukStr].participants) {
                    const p = juzukData[juzukStr].participants.find(p => p.ic === ic);
                    if (p) p.status = newStatus;
                    saveToLocalStorage();
                }
            }
        }

        async function removeParticipant(juzukId, ic, name) {
            if (!confirm(`Padam ${name} dari senarai?`)) return;
            const juzukStr = juzukId.toString();

            if (isOnlineMode) {
                const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukStr);
                try {
                    const docSnap = await getDoc(juzukRef);
                    if (docSnap.exists()) {
                        let participants = docSnap.data().participants || [];
                        const updatedParticipants = participants.filter(p => p.ic !== ic);
                        await updateDoc(juzukRef, { participants: updatedParticipants });
                        showToast("Peserta dipadam.");
                    }
                } catch (e) { console.error(e); }
            } else {
                if (juzukData[juzukStr] && juzukData[juzukStr].participants) {
                    juzukData[juzukStr].participants = juzukData[juzukStr].participants.filter(p => p.ic !== ic);
                    saveToLocalStorage();
                    showToast("Peserta dipadam (Lokal).");
                }
            }
        }
        
        async function clearAllData() {
            if (!confirm("AWAS: Padam SEMUA data?")) return;
            if (!confirm("Tindakan ini kekal.")) return;
            
            if (isOnlineMode) {
                 for(let i=1; i<=30; i++) {
                     const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', i.toString());
                     setDoc(juzukRef, { participants: [] });
                 }
            } else {
                juzukData = {};
                localStorage.removeItem('tadarus_data_v2');
                renderList();
            }
            showToast("Data diset semula.");
        }

        // --- UI Rendering ---
        function renderList() {
            const container = document.getElementById('juzukContainer');
            container.innerHTML = '';
            
            const daysLeft = getDaysRemaining();
            document.getElementById('daysRemainingBadge').innerText = `${daysLeft} Hari Lagi`;
            document.getElementById('targetDateDisplay').innerText = `Sasaran: 6 Mac 2026`;

            let totalParticipants = 0;
            let totalDone = 0;

            for (let i = 1; i <= 30; i++) {
                const data = juzukData[i.toString()] || { participants: [] };
                const participants = data.participants || [];
                
                totalParticipants += participants.length;
                const doneInJuz = participants.filter(p => p.status === 'done').length;
                totalDone += doneInJuz;
                const isJuzukComplete = participants.length > 0 && doneInJuz === participants.length;

                const card = document.createElement('div');
                card.className = `bg-white p-4 rounded-xl card-shadow border-l-4 transition-all mb-3 ${isJuzukComplete ? 'border-green-500 bg-green-50/50' : 'border-emerald-500'}`;
                
                const juzName = juzukNames[i-1];
                const totalAyat = juzukVersesCount[i-1];
                
                // --- LOGIK PEMBAHAGIAN AYAT ---
                const activeParticipants = participants.length > 0 ? participants.length : 1;
                const ayatPerPersonTotal = Math.ceil(totalAyat / activeParticipants);
                const ayatPerDay = daysLeft > 0 ? Math.ceil(ayatPerPersonTotal / daysLeft) : ayatPerPersonTotal;

                // Teks Tambahan untuk UI
                let splitInfoText = '';
                if (participants.length > 1) {
                    splitInfoText = `
                        <div class="mt-1 text-[10px] text-emerald-600 bg-emerald-100/50 px-2 py-1 rounded inline-block">
                            <i class="fas fa-users mr-1"></i> Dikongsi ${participants.length} orang (${ayatPerPersonTotal} ayat/seorang)
                        </div>
                    `;
                }

                const progressNote = isJuzukComplete 
                    ? `<div class="bg-green-50 p-2 rounded-lg border border-green-100 mb-2 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        <div>
                            <p class="text-xs font-bold text-green-700">Juzuk Selesai</p>
                        </div>
                     </div>`
                    : `<div class="bg-blue-50/80 p-3 rounded-lg border border-blue-100 mb-2">
                        <div class="flex flex-col">
                            <div class="flex justify-between items-baseline">
                                <span class="text-[10px] text-blue-600 uppercase font-bold tracking-wide">Target Harian Anda</span>
                                <span class="text-[10px] text-gray-400">Total Juz: ${totalAyat} ayat</span>
                            </div>
                            <div class="flex items-end gap-1 mt-1">
                                <span class="text-2xl font-bold text-blue-700 leading-none">${ayatPerDay}</span>
                                <span class="text-xs text-blue-600 font-medium mb-0.5">ayat / hari</span>
                            </div>
                            ${splitInfoText}
                        </div>
                     </div>`;

                let participantsHtml = '';
                if (participants.length > 0) {
                    participantsHtml = `<div class="mt-3 space-y-2">`;
                    participants.forEach(p => {
                        const isDone = p.status === 'done';
                        participantsHtml += `
                            <div class="flex items-center justify-between bg-gray-50 rounded-lg p-2 border border-gray-100 group">
                                <div class="flex items-center gap-3">
                                    <button onclick="toggleStatus(${i}, '${p.ic}', '${p.status}')" 
                                        class="w-6 h-6 rounded flex items-center justify-center transition-colors ${isDone ? 'bg-green-500 text-white' : 'bg-white border border-gray-300 text-gray-300 hover:border-green-400'}">
                                        ${isDone ? '<i class="fas fa-check text-xs"></i>' : ''}
                                    </button>
                                    <div class="flex flex-col">
                                        <span class="text-sm font-semibold text-gray-800 ${isDone ? 'line-through text-gray-400' : ''}">${p.name}</span>
                                    </div>
                                </div>
                                <button onclick="removeParticipant(${i}, '${p.ic}', '${p.name}')" class="text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    });
                    participantsHtml += `</div>`;
                } else {
                    participantsHtml = `<div class="mt-2 text-xs text-gray-400 italic">Belum ada peserta.</div>`;
                }

                card.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex flex-col items-center justify-center w-14 text-center pt-1">
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Juz</span>
                            <span class="text-xl font-bold text-emerald-700 font-arabic leading-none">${i}</span>
                        </div>
                        
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-[10px] font-semibold text-emerald-600 uppercase tracking-wide truncate pr-2">${juzName}</div>
                                <button onclick="openRegistrationModal(${i})" class="shrink-0 text-xs bg-emerald-100 hover:bg-emerald-200 text-emerald-700 px-2 py-1 rounded-full font-medium transition-colors">
                                    <i class="fas fa-plus mr-1"></i> Tambah
                                </button>
                            </div>
                            
                            ${progressNote}
                            
                            ${participantsHtml}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            }
            updateProgress(totalDone, totalParticipants);
        }

        function updateProgress(done, total) {
            const percentage = total > 0 ? Math.round((done / total) * 100) : 0;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('completedCount').innerText = `${done} Selesai dibaca`;
        }

        // --- Helpers ---
        function openRegistrationModal(juz) {
            currentJuzukSelection = juz;
            document.getElementById('modalJuzInfo').innerText = `Juzuk ${juz} (${juzukNames[juz-1]}) - ${juzukVersesCount[juz-1]} Ayat`;
            document.getElementById('modalIC').value = '';
            document.getElementById('modalName').value = '';
            document.getElementById('icFeedback').innerHTML = '';
            document.getElementById('nameInputContainer').classList.add('hidden');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('authModal').classList.remove('hidden');
            setTimeout(() => document.getElementById('modalIC').focus(), 100);
        }

        function closeModal() {
            document.getElementById('authModal').classList.add('hidden');
            currentJuzukSelection = null;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = message;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        function copyToWhatsapp() {
            const daysLeft = getDaysRemaining();
            let text = `*TADARUS BULAN RAMADHAN, PPD MIRI* ðŸŒ™\n`;
            text += `_Sasaran Khatam: 6 Mac 2026 (${daysLeft} Hari Lagi)_\n\n`;
            
            let emptyJuzuks = 0;

            for (let i = 1; i <= 30; i++) {
                const data = juzukData[i.toString()] || { participants: [] };
                const list = data.participants || [];
                const juzName = juzukNames[i-1];
                
                if (list.length === 0) {
                    text += `â¬œ Juz ${i}: _(Kosong)_\n`;
                    emptyJuzuks++;
                } else {
                    text += `ðŸ”¹ Juz ${i}:\n`;
                    list.forEach(p => {
                        const icon = p.status === 'done' ? 'âœ…' : 'ðŸ“–';
                        text += `    ${icon} ${p.name}\n`;
                    });
                }
            }

            text += `\nðŸ“Š *Info:* ${emptyJuzuks} Juzuk masih kosong.\nMohon sertai kami untuk memeriahkan bulan Al-Quran. Terima kasih!`;

            navigator.clipboard.writeText(text).then(() => {
                showToast("Senarai disalin ke clipboard!");
            }).catch(err => {
                showToast("Gagal menyalin.");
            });
        }
    </script>
</body>
</html>
