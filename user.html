<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK â€“ Papan Pemuka Pengguna</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); transition: transform 0.2s ease-in-out; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .btn { transition: background-color 0.3s, transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        
        /* Kesan Glassmorphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-screen-2xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4">
            <div class="flex items-center gap-3 self-start sm:self-center">
                <div class="bg-indigo-600 p-2 rounded-lg logo-pulse"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white"><path d="M4 4H8V8H4V4Z" fill="currentColor"></path><path d="M4 16H8V20H4V16Z" fill="currentColor"></path><path d="M16 4H20V8H16V4Z" fill="currentColor"></path><path d="M10 4H14V6H10V4Z" fill="currentColor"></path><path d="M10 8H12V10H10V8Z" fill="currentColor"></path><path d="M12 12H14V14H12V12Z" fill="currentColor"></path><path d="M10 16H12V18H10V16Z" fill="currentColor"></path><path d="M14 16H16V18H14V16Z" fill="currentColor"></path><path d="M16 12H18V14H16V12Z" fill="currentColor"></path><path d="M16 8H20V10H16V8Z" fill="currentColor"></path><path d="M12 18H14V20H12V18Z" fill="currentColor"></path><path d="M4 10H6V14H4V10Z" fill="currentColor"></path></svg></div>
                <div>
                    <h1 class="text-2xl font-bold text-indigo-600">SPARK</h1>
                    <p class="text-sm text-gray-500">Percikan Inovasi Kehadiran Digital</p>
                </div>
            </div>
            <div id="header-buttons" class="flex w-full sm:w-auto justify-center sm:justify-end items-center gap-2 sm:gap-4 flex-wrap">
                 <button onclick="window.location.href='index.html'" class="btn bg-gray-100 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-200 flex items-center gap-2 text-xs sm:text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    Halaman Utama
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full bg-gray-50">
        
        <!-- 1. HERO SECTION (NO IMAGE - GRADIENT ONLY) -->
        <div class="relative w-full h-[400px] bg-gradient-to-br from-indigo-900 to-purple-800">
            <div class="absolute inset-0 bg-black/20"></div> <!-- Slight overlay texture -->
            <!-- Gambar latar belakang telah dibuang seperti diminta -->
        </div>

        <!-- 2. OVERLAPPING PROFILE CARD SECTION -->
        <div class="relative z-10 px-4 sm:px-6 lg:px-8 -mt-24">
            <div class="max-w-4xl mx-auto">
                <div class="glass-card p-6 md:p-10 rounded-2xl shadow-2xl">
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="bg-indigo-100 p-4 rounded-full border-4 border-white shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <div class="text-center md:text-left flex-grow">
                            <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900 tracking-tight mb-1" id="user-name">Memuatkan...</h2>
                            <div class="flex flex-col md:flex-row gap-2 md:gap-4 text-gray-600 text-sm font-medium justify-center md:justify-start">
                                <span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0c0 .884-.5 1.5-1.5 1.5S8 7 8 6m4 0c0 .884.5 1.5 1.5 1.5S15 7 15 6"></path></svg> <span id="user-ic">-</span></span>
                                <span class="hidden md:inline">|</span>
                                <span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg> <span id="user-org">-</span></span>
                            </div>
                        </div>
                        <div class="text-right">
                             <div class="bg-indigo-50 px-4 py-2 rounded-lg border border-indigo-100">
                                 <p class="text-xs text-gray-500 uppercase font-bold">Jumlah Program</p>
                                 <p class="text-2xl font-bold text-indigo-600" id="total-programs-count">0</p>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. CONTENT CONTAINER -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">

                <!-- MAIN COLUMN (Table) -->
                <div class="lg:col-span-3 space-y-8">
                    
                    <!-- Search & Filter Controls -->
                    <div class="card p-5 border border-gray-100 bg-white">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                                </svg>
                                Sejarah Penyertaan Program
                            </h3>
                            <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                                <!-- Row Limit Selector (Updated with 5, 10, 15, 30, 50) -->
                                <div class="relative">
                                    <select id="rows-per-page" onchange="changeRowsPerPage(this.value)" class="appearance-none pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full text-sm bg-white cursor-pointer">
                                        <option value="5">5 Paparan</option>
                                        <option value="10" selected>10 Paparan</option>
                                        <option value="15">15 Paparan</option>
                                        <option value="30">30 Paparan</option>
                                        <option value="50">50 Paparan</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </div>
                                </div>
                                
                                <!-- Search Bar -->
                                <div class="relative w-full sm:w-64">
                                    <input type="text" id="search-input" oninput="filterTable()" placeholder="Cari program..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full text-sm">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Programs Table -->
                    <div class="card overflow-hidden shadow-lg border border-gray-100">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-10">Bil</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Nama Program</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tarikh & Lokasi</th>
                                        <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Status</th>
                                        <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-20">Info</th>
                                    </tr>
                                </thead>
                                <tbody id="programs-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Javascript will populate rows here -->
                                    <tr>
                                        <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                                            <div class="flex flex-col items-center justify-center">
                                                <svg class="animate-spin h-6 w-6 text-indigo-500 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
                                                Sedang memuatkan data...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div id="no-data-message" class="hidden text-center py-10">
                            <p class="text-gray-500">Tiada rekod penyertaan ditemui.</p>
                        </div>

                        <!-- Pagination Controls -->
                        <div id="pagination-controls" class="px-6 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-xs text-gray-500" id="pagination-info">
                                Menunjukkan 0 hingga 0 daripada 0 rekod
                            </div>
                            <div class="flex gap-2">
                                <button onclick="prevPage()" id="btn-prev" class="px-3 py-1 border border-gray-300 rounded-md text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Sebelumnya
                                </button>
                                <button onclick="nextPage()" id="btn-next" class="px-3 py-1 border border-gray-300 rounded-md text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                    Seterusnya
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SIDEBAR COLUMN (Widgets) -->
                <div class="lg:col-span-1 space-y-6">

                    <!-- Logout Widget -->
                    <div class="card p-6 border-t-4 border-red-500 bg-white shadow-lg relative overflow-hidden group">
                        <div class="relative z-10">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">Akaun</h3>
                            <button onclick="logout()" class="w-full flex justify-center items-center gap-2 py-2.5 px-4 border border-red-500 text-sm font-bold rounded-lg text-red-600 bg-white hover:bg-red-50 transition-all shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                                Log Keluar
                            </button>
                        </div>
                    </div>

                    <!-- Quick Links Widget -->
                    <div class="card p-5 border border-gray-200 bg-white">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 border-b pb-2">Menu Pantas</h3>
                        <div class="space-y-3">
                            <a href="jadual.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-purple-50 transition-colors border border-gray-100 hover:border-purple-200">
                                <div class="bg-purple-100 text-purple-600 p-2 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg></div>
                                <div><p class="text-sm font-semibold text-gray-700">Kalendar Program</p></div>
                            </a>
                            <a href="senarai.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-pink-50 transition-colors border border-gray-100 hover:border-pink-200">
                                <div class="bg-pink-100 text-pink-600 p-2 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg></div>
                                <div><p class="text-sm font-semibold text-gray-700">Senarai Program</p></div>
                            </a>
                        </div>
                    </div>

                    <!-- Feedback Widget -->
                    <div class="card p-5 border border-gray-200 bg-gray-50">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Komuniti</h3>
                        <p class="text-xs text-gray-600 mb-4">Ada masalah dengan rekod anda?</p>
                        <button onclick="safeNavigate('index.html')" class="btn w-full bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 flex items-center justify-center gap-2 text-sm shadow-sm">
                            Hubungi Admin
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </main>

    <footer class="text-center py-4 mt-8 border-t border-gray-200 bg-white"><p class="text-sm text-gray-600">Projek Inovasi oleh <a href="https://pahanmy.github.io/works/" target="_blank" class="font-semibold text-indigo-500 hover:underline">Pahan</a></p><p id="version-info" class="text-xs text-gray-500"></p></footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM",
            authDomain: "myqrhadir.firebaseapp.com",
            projectId: "myqrhadir",
            storageBucket: "myqrhadir.appspot.com",
            messagingSenderId: "799691133747",
            appId: "1:799691133747:web:835a5e3e9413eace806446"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = firebaseConfig.projectId;

        let currentUserIc = "";
        let certificateResults = [];
        let filteredResults = []; // Store filtered data for pagination
        let currentPage = 1;
        let rowsPerPage = 10;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const storedIc = localStorage.getItem('user_ic');

                if (storedIc) {
                    currentUserIc = storedIc;
                    loadUserData(currentUserIc);
                } else {
                    const input = prompt("Sesi tamat atau tiada data. Sila masukkan No. IC anda:");
                    if (input) {
                        currentUserIc = input.trim();
                        localStorage.setItem('user_ic', currentUserIc); 
                        loadUserData(currentUserIc);
                    } else {
                        safeNavigate('index.html');
                    }
                }
            } else {
                signInAnonymously(auth).catch(console.error);
            }
        });

        async function loadUserData(ic) {
            try {
                const programsRef = collection(db, `artifacts/${appId}/public/data/spark_programs`);
                const programsSnapshot = await getDocs(programsRef);

                certificateResults = [];
                let participantData = null;

                programsSnapshot.forEach(programDoc => {
                    const programData = programDoc.data();
                    const attendanceArray = programData.attendance || [];
                    const pData = attendanceArray.find(p => p.ic === ic);

                    if (pData) {
                        if (!participantData) participantData = pData;
                        
                        certificateResults.push({
                            programData: programData,
                            participantData: pData
                        });
                    }
                });

                if (participantData) {
                    document.getElementById('user-name').textContent = participantData.name.toUpperCase();
                    document.getElementById('user-ic').textContent = formatIc(participantData.ic);
                    document.getElementById('user-org').textContent = participantData.station || participantData.org || "-";
                } else {
                    document.getElementById('user-name').textContent = "Tiada Rekod";
                    document.getElementById('user-ic').textContent = ic;
                    document.getElementById('user-org').textContent = "-";
                }
                
                document.getElementById('total-programs-count').textContent = certificateResults.length;
                
                // Susun data terkini di atas
                certificateResults.sort((a, b) => {
                    const dateA = new Date(a.programData.startDate);
                    const dateB = new Date(b.programData.startDate);
                    return dateB - dateA;
                });

                filteredResults = [...certificateResults]; // Init filtered results
                renderTable();

            } catch (error) {
                console.error("Error loading user data:", error);
                alert("Gagal memuatkan data. Sila cuba lagi.");
            }
        }

        function renderTable() {
            const tbody = document.getElementById('programs-table-body');
            const noDataMsg = document.getElementById('no-data-message');
            
            tbody.innerHTML = '';

            if (filteredResults.length === 0) {
                noDataMsg.classList.remove('hidden');
                document.getElementById('pagination-controls').classList.add('hidden');
                return;
            } else {
                noDataMsg.classList.add('hidden');
                document.getElementById('pagination-controls').classList.remove('hidden');
            }
            
            // Pagination Logic
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const paginatedData = filteredResults.slice(startIndex, endIndex);

            paginatedData.forEach((item, index) => {
                const row = createTableRow(item, startIndex + index);
                tbody.innerHTML += row;
            });

            updatePaginationInfo();
        }

        function createTableRow(result, index) {
            const { programData, participantData } = result;
            const startDateStr = programData.startDate ? new Date(programData.startDate + 'T00:00:00').toLocaleDateString('ms-MY', { day: 'numeric', month: 'short', year: 'numeric' }) : '-';
            const location = programData.location || 'Dalam Talian';
            const statusBadge = `<span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Hadir</span>`;

            // Link ke program
            const programLink = `program.html?kod=${programData.key || ''}`;

            return `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${index + 1}.</td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-semibold text-gray-900">${programData.name}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                        <div class="font-medium text-gray-900">${startDateStr}</div>
                        <div class="text-xs text-gray-500">${location}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">${statusBadge}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <a href="${programLink}" class="inline-flex items-center justify-center p-2 rounded-full text-indigo-600 hover:bg-indigo-50 transition-colors group" title="Lihat Program">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                    </td>
                </tr>
            `;
        }
        
        function filterTable() {
            const input = document.getElementById('search-input');
            const filter = input.value.toUpperCase();
            filteredResults = certificateResults.filter(item => 
                item.programData.name.toUpperCase().includes(filter)
            );
            currentPage = 1; // Reset to page 1 on search
            renderTable();
        }

        function formatIc(ic) {
            if (ic && ic.length === 12) {
                return ic.slice(0, 6) + "-" + ic.slice(6, 8) + "-" + ic.slice(8);
            }
            return ic;
        }

        // Pagination Functions
        function changeRowsPerPage(val) {
            rowsPerPage = parseInt(val);
            currentPage = 1;
            renderTable();
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }

        function nextPage() {
            if ((currentPage * rowsPerPage) < filteredResults.length) {
                currentPage++;
                renderTable();
            }
        }

        function updatePaginationInfo() {
            const total = filteredResults.length;
            const start = total === 0 ? 0 : (currentPage - 1) * rowsPerPage + 1;
            const end = Math.min(start + rowsPerPage - 1, total);
            
            document.getElementById('pagination-info').textContent = `Menunjukkan ${start} hingga ${end} daripada ${total} rekod`;
            
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = end >= total;
        }

        // --- Helper: Safe Navigation untuk elak ralat di preview ---
        function safeNavigate(url) {
            try {
                window.location.href = url;
            } catch (e) {
                console.warn("Navigasi dihalang (persekitaran preview):", e);
            }
        }

        function logout() {
            localStorage.removeItem('user_ic');
            safeNavigate('index.html');
        }

        // Manual export ke window
        window.logout = logout;
        window.filterTable = filterTable;
        window.safeNavigate = safeNavigate;
        window.changeRowsPerPage = changeRowsPerPage;
        window.prevPage = prevPage;
        window.nextPage = nextPage;
    </script>
</body>
</html>
