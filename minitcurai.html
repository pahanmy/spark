<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK Curai ‚Äì Minit & Nota Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f0f9ff; } /* Sky-50 */
        
        /* A4 Paper Styling */
        #pdf-wrapper { width: 210mm; margin: 0 auto; background: white; }
        .a4-paper {
            width: 210mm; min-height: 297mm; 
            padding: 15mm 20mm; /* Adjusted padding for header space */
            background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            color: black; position: relative;
            font-family: 'Arial', sans-serif; 
        }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #0284c7; border-radius: 3px; }

        /* Form Inputs */
        .input-group { margin-bottom: 0.75rem; }
        .input-label { display: block; font-size: 0.7rem; font-weight: 700; color: #475569; text-transform: uppercase; margin-bottom: 0.25rem; }
        .spark-input { width: 100%; font-size: 0.8rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; padding: 0.5rem; transition: all 0.2s; background: white; }
        .spark-input:focus { outline: none; border-color: #0284c7; ring: 2px solid #e0f2fe; }

        /* Preview Table */
        .minit-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 10pt; }
        .minit-table th, .minit-table td { border: 1px solid #000; padding: 6px 8px; vertical-align: top; }
        .minit-header { background-color: #e0f2fe; font-weight: bold; width: 25%; }

        /* List Styling in Preview */
        ol.preview-list { list-style-type: none; padding-left: 0; margin: 0; counter-reset: item; }
        ol.preview-list > li { margin-bottom: 1rem; position: relative; padding-left: 2rem; }
        ol.preview-list > li::before { 
            content: counter(item) "."; 
            counter-increment: item; 
            position: absolute; 
            left: 0; 
            font-weight: bold; 
        }
        
        /* Status Tag Styling */
        .status-tag {
            display: block;
            text-align: right;
            margin-top: 4px;
            font-size: 8pt;
            font-weight: bold;
            font-style: italic;
        }

        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .a4-paper { box-shadow: none; margin: 0; }
        }
        
        /* Modal Backdrop */
        .modal-backdrop { background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-gray-800">

    <header class="bg-white shadow-sm border-b border-gray-200 z-50 no-print flex-shrink-0">
        <div class="w-full px-6 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-sky-600 p-2 rounded-lg shadow-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-sky-700 uppercase tracking-wide flex items-center gap-2">
                        SPARK CURAI
                    </h1>
                    <p class="text-xs text-gray-500">Penjana Minit Curai Digital</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <button onclick="showCreditModal()" class="text-xs font-bold text-indigo-600 bg-indigo-50 border border-indigo-200 hover:bg-indigo-100 px-3 py-2 rounded-lg flex items-center gap-1 transition-colors mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-indigo-500" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z" />
                    </svg>
                    Idea Asal
                </button>

                <button onclick="window.location.href='user.html'" class="text-gray-500 hover:text-sky-600 text-sm font-semibold px-3 flex items-center gap-1 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                    Kembali
                </button>
                <div class="h-6 w-px bg-gray-300 mx-1"></div>
                
                <button onclick="downloadPDF()" class="bg-sky-600 hover:bg-sky-700 text-white text-xs font-bold py-2 px-5 rounded-lg shadow-md flex items-center gap-2 uppercase transition-transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    Muat Turun PDF
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <div class="w-full lg:w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-5 no-print z-10 custom-scrollbar">
            
            <div class="mb-4 flex gap-2">
                <button onclick="loadDemoData()" class="flex-1 bg-gray-100 text-gray-600 border border-gray-200 py-2 rounded text-xs font-bold uppercase hover:bg-gray-200 transition">
                    üìÇ Muat Data Contoh
                </button>
                <button onclick="clearForm()" class="flex-1 bg-red-50 text-red-600 border border-red-200 py-2 rounded text-xs font-bold uppercase hover:bg-red-100 transition">
                    üóëÔ∏è Kosongkan
                </button>
            </div>

            <form id="minit-form" oninput="updatePreview()">
                
                <div class="bg-sky-50 p-4 rounded-xl border border-sky-100 mb-4">
                    <h3 class="text-xs font-bold text-sky-700 uppercase mb-3 border-b border-sky-200 pb-2">Butiran Mesyuarat</h3>
                    
                    <div class="input-group">
                        <label class="input-label">Tajuk Program / Mesyuarat</label>
                        <textarea id="in-tajuk" rows="2" class="spark-input font-bold uppercase" placeholder="Tajuk..."></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="input-group">
                            <label class="input-label">Tarikh</label>
                            <input type="text" id="in-tarikh" class="spark-input font-semibold">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Masa</label>
                            <input type="text" id="in-masa" class="spark-input font-semibold">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Tempat / Platform</label>
                        <input type="text" id="in-tempat" class="spark-input" placeholder="Contoh: Bilik Gerakan">
                    </div>
                     <div class="input-group">
                        <label class="input-label">Pengerusi / Anjuran</label>
                        <input type="text" id="in-anjuran" class="spark-input" placeholder="Contoh: PPD Miri">
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-xl p-4 mb-4 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xs font-bold text-gray-700 uppercase">Isi Kandungan & Tindakan</h3>
                    </div>
                    
                    <div id="points-container" class="space-y-4">
                        </div>

                    <button type="button" onclick="addPoint()" class="mt-4 w-full py-2 bg-sky-100 text-sky-700 border border-sky-200 rounded-lg text-xs font-bold uppercase hover:bg-sky-200 transition flex justify-center items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        Tambah Poin Utama
                    </button>
                </div>

                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <h3 class="text-xs font-bold text-gray-500 uppercase mb-3 border-b border-gray-200 pb-2">Disediakan Oleh</h3>
                    
                    <div class="input-group">
                        <label class="input-label">Nama Pegawai</label>
                        <input type="text" id="in-nama" class="spark-input font-bold uppercase">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Jawatan</label>
                        <input type="text" id="in-jawatan" class="spark-input uppercase">
                    </div>
                </div>

            </form>
        </div>

        <div class="w-full lg:w-2/3 bg-gray-100 overflow-auto flex justify-center p-8 custom-scrollbar">
            <div id="pdf-wrapper">
                <div class="a4-paper transform scale-100 origin-top" id="main-report">
                    
                    <div class="absolute top-5 right-5 text-right z-10">
                        <svg id="barcode"></svg>
                    </div>

                    <div class="text-center border-b-2 border-black pb-4 mb-6 mt-6">
                        <h2 class="text-xl font-bold uppercase tracking-wider mb-2 text-black">MINIT CURAI</h2>
                        <h3 id="out-tajuk" class="text-lg font-semibold uppercase text-gray-800 leading-tight">TAJUK PROGRAM</h3>
                    </div>

                    <table class="minit-table mb-6">
                        <tr>
                            <th class="minit-header">TARIKH</th>
                            <td id="out-tarikh" class="w-1/4 uppercase"></td>
                            <th class="minit-header">MASA</th>
                            <td id="out-masa" class="w-1/4 uppercase"></td>
                        </tr>
                        <tr>
                            <th class="minit-header">TEMPAT</th>
                            <td id="out-tempat" colspan="3" class="uppercase"></td>
                        </tr>
                         <tr>
                            <th class="minit-header">ANJURAN</th>
                            <td id="out-anjuran" colspan="3" class="uppercase"></td>
                        </tr>
                    </table>

                    <div class="mb-8">
                        <h4 class="text-sm font-bold uppercase border-b border-gray-300 mb-4 pb-1">Kandungan / Coretan Mesyuarat</h4>
                        
                        <ol id="out-content" class="preview-list text-sm text-justify leading-relaxed">
                            </ol>
                    </div>

                    <div class="mt-auto flex justify-end pt-10 break-inside-avoid">
                        <div class="w-1/3">
                            <p class="text-xs italic mb-10 text-left">Disediakan oleh:</p>
                            
                            <p id="out-nama" class="font-bold uppercase text-sm border-b border-black inline-block min-w-full text-left pb-1">NAMA PEGAWAI</p>
                            <p id="out-jawatan" class="text-xs uppercase text-left mt-1">JAWATAN</p>
                            <p id="out-tarikh-laporan" class="text-xs text-left mt-1 uppercase">TARIKH</p>
                        </div>
                    </div>

                    <div class="absolute bottom-4 left-0 w-full text-center">
                        <p class="text-[8px] text-gray-300 uppercase tracking-[0.2em]">Dijana oleh SPARK Curai</p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="credit-modal" class="fixed inset-0 z-[100] flex items-center justify-center modal-backdrop hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 relative transform transition-all scale-100">
            <button onclick="closeCreditModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                </div>
                
                <h3 class="text-xl font-extrabold text-gray-900 mb-1 uppercase tracking-tight">Penghargaan Khas</h3>
                <p class="text-xs text-indigo-500 font-bold uppercase mb-4 tracking-wider">Spark Inovasi</p>
                
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-100 mb-4">
                    <p class="text-sm text-gray-600 mb-2">Setinggi-tinggi penghargaan diucapkan kepada:</p>
                    <p class="text-lg font-bold text-gray-800 uppercase">PN. SU YIEN JIONG</p>
                    <p class="text-xs text-gray-500 uppercase font-semibold">(SIPartners+ PPD Miri)</p>
                </div>
                
                <p class="text-xs text-gray-500 italic">
                    Atas idea bernas untuk mewujudkan modul <strong>Minit Curai Digital</strong> dalam sistem SPARK bagi memudahkan pengurusan pelaporan pegawai.
                </p>

                <div class="mt-6">
                    <button onclick="closeCreditModal()" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:text-sm uppercase tracking-wide">
                        Terima Kasih Cikgu!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let mainPointCounter = 0;
        const subPointCounters = {}; 

        window.onload = function() {
            setDefaults();
            renderBarcode();
            addPoint(); 
        };

        function setDefaults() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('ms-MY', options);
            const timeStr = now.toLocaleTimeString('ms-MY', { hour: '2-digit', minute: '2-digit' });

            document.getElementById('in-tarikh').value = dateStr;
            document.getElementById('in-masa').value = timeStr;
            document.getElementById('out-tarikh-laporan').textContent = dateStr;
        }

        // --- BARCODE GENERATOR ---
        function renderBarcode() {
            const now = new Date();
            const dateCode = now.getFullYear().toString().substr(-2) + (now.getMonth()+1).toString().padStart(2,'0') + now.getDate().toString().padStart(2,'0');
            const randomCode = Math.floor(1000 + Math.random() * 9000);
            const serial = `SPARK-${dateCode}-${randomCode}`;

            JsBarcode("#barcode", serial, {
                format: "CODE128",
                width: 1,
                height: 25,
                displayValue: true,
                fontSize: 10,
                margin: 0,
                textMargin: 2,
                lineColor: "#333"
            });
        }

        // --- MODAL LOGIC ---
        window.showCreditModal = function() {
            document.getElementById('credit-modal').classList.remove('hidden');
        }
        window.closeCreditModal = function() {
            document.getElementById('credit-modal').classList.add('hidden');
        }

        // --- POINT SYSTEM LOGIC ---

        // 1. Add Main Point (With Action/Status Dropdown)
        window.addPoint = function(text = "", status = "MAKLUMAN", who = "") {
            mainPointCounter++;
            subPointCounters[mainPointCounter] = 0;

            const container = document.getElementById('points-container');
            const pointDiv = document.createElement('div');
            pointDiv.id = `group-main-${mainPointCounter}`;
            pointDiv.className = "bg-gray-50 border border-gray-200 rounded-lg p-3 transition-all hover:shadow-sm";
            
            // Logic to hide/show "Siapa" input
            const isTindakan = status === "TINDAKAN";
            const whoHiddenClass = isTindakan ? "" : "hidden";

            pointDiv.innerHTML = `
                <div class="flex gap-2 items-start mb-2">
                    <span class="mt-2 text-xs font-bold text-gray-400 bg-white border border-gray-200 w-6 h-6 flex items-center justify-center rounded-full">${mainPointCounter}</span>
                    <div class="flex-grow">
                        <textarea id="input-main-${mainPointCounter}" rows="2" class="spark-input text-sm mb-2" placeholder="Isi Poin Utama..." oninput="updatePreview()">${text}</textarea>
                        
                        <div class="flex items-center gap-2 bg-white p-2 rounded border border-gray-200">
                            <div class="w-1/3">
                                <label class="text-[9px] font-bold text-gray-400 uppercase block mb-1">Jenis Perkara</label>
                                <select id="status-main-${mainPointCounter}" onchange="toggleActionInput(${mainPointCounter}); updatePreview()" class="w-full text-xs border border-gray-300 rounded p-1">
                                    <option value="MAKLUMAN" ${status === "MAKLUMAN" ? "selected" : ""}>Makluman</option>
                                    <option value="TINDAKAN" ${status === "TINDAKAN" ? "selected" : ""}>Tindakan</option>
                                </select>
                            </div>
                            <div class="w-2/3 ${whoHiddenClass}" id="action-wrapper-${mainPointCounter}">
                                <label class="text-[9px] font-bold text-red-400 uppercase block mb-1">Tindakan Siapa?</label>
                                <input type="text" id="who-main-${mainPointCounter}" value="${who}" oninput="updatePreview()" class="w-full text-xs border border-red-200 bg-red-50 rounded p-1 placeholder-red-200 text-red-700" placeholder="Cth: Semua Guru / KP...">
                            </div>
                        </div>
                    </div>

                    <button type="button" onclick="deleteMainPoint(${mainPointCounter})" class="mt-1 text-gray-400 hover:text-red-500" title="Padam Poin Ini">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    </button>
                </div>
                
                <div id="sub-container-${mainPointCounter}" class="pl-8 space-y-2"></div>

                <div class="pl-8 mt-2">
                    <button type="button" onclick="addSubPoint(${mainPointCounter})" class="text-[10px] font-bold text-sky-600 hover:text-sky-800 flex items-center gap-1 uppercase bg-white px-2 py-1 rounded border border-sky-100 hover:bg-sky-50 shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                        Tambah Sub-Poin
                    </button>
                </div>
            `;
            
            container.appendChild(pointDiv);
            updatePreview();
        }

        window.toggleActionInput = function(id) {
            const select = document.getElementById(`status-main-${id}`);
            const wrapper = document.getElementById(`action-wrapper-${id}`);
            if (select.value === "TINDAKAN") {
                wrapper.classList.remove("hidden");
            } else {
                wrapper.classList.add("hidden");
            }
        }

        // 2. Add Sub Point (Nested)
        window.addSubPoint = function(parentId, text = "") {
            subPointCounters[parentId]++;
            const subId = subPointCounters[parentId];
            
            const subContainer = document.getElementById(`sub-container-${parentId}`);
            const subDiv = document.createElement('div');
            subDiv.id = `group-sub-${parentId}-${subId}`;
            subDiv.className = "flex gap-2 items-start";
            
            subDiv.innerHTML = `
                <span class="mt-2 text-[10px] text-gray-400">‚Ä¢</span>
                <textarea id="input-sub-${parentId}-${subId}" rows="1" class="spark-input text-xs bg-white" placeholder="Isi Sub-Poin..." oninput="updatePreview()">${text}</textarea>
                <button type="button" onclick="deleteSubPoint('${parentId}-${subId}')" class="mt-1 text-gray-300 hover:text-red-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            `;
            
            subContainer.appendChild(subDiv);
            updatePreview();
        }

        // 3. Delete Functions
        window.deleteMainPoint = function(id) {
            const el = document.getElementById(`group-main-${id}`);
            if(el) el.remove();
            updatePreview();
        }

        window.deleteSubPoint = function(uniqueId) {
            const el = document.getElementById(`group-sub-${uniqueId}`);
            if(el) el.remove();
            updatePreview();
        }

        window.clearForm = function() {
            document.getElementById('points-container').innerHTML = '';
            document.getElementById('in-tajuk').value = '';
            document.getElementById('in-tempat').value = '';
            document.getElementById('in-anjuran').value = '';
            mainPointCounter = 0;
            addPoint(); 
            updatePreview();
        }

        // --- DEMO DATA ---
        window.loadDemoData = function() {
            document.getElementById('points-container').innerHTML = '';
            mainPointCounter = 0;

            document.getElementById('in-tajuk').value = "CORETAN PESANAN PENGARAH JPNS DALAM SLU BERSAMA SEMUA SIPARTNERS+ SARAWAK";
            document.getElementById('in-tempat').value = "Secara dalam talian (Google Meet)";
            document.getElementById('in-anjuran').value = "Sektor Pembelajaran JPNS";
            document.getElementById('in-nama').value = "PN. SU YIEN JIONG";
            document.getElementById('in-jawatan').value = "SIPARTNERS+ PPD MIRI";

            const demoPoints = [
                { main: "Terima kasih atas kehadiran semua barisan SIPartners+ negeri Sarawak.", subs: [], status: "MAKLUMAN" },
                { 
                    main: "Rancangan Pendidikan Malaysia (RPM) 2026-2035: PGB perlu sebarluaskan RPM terkini di peringkat sekolah.", 
                    subs: ["Sedikit Perubahan: 'Berkualiti' ditukarkan kepada 'Bermutu'."], 
                    status: "TINDAKAN", who: "SEMUA PENGETUA & GURU BESAR" 
                },
                { 
                    main: "Isu-isu sekolah: PGB perlu menandatangani dengan lebih baik dan peka terhadap keperluan di sekolah.", 
                    subs: ["Uruskan dengan sebaik mungkin sebab masyarakat memerhatikan apa yang kita buat."], 
                    status: "TINDAKAN", who: "PGB" 
                },
                {
                    main: "Pencapaian akademik di negeri Sarawak masih pada tahap yang rendah.",
                    subs: [], status: "MAKLUMAN"
                }
            ];

            demoPoints.forEach(p => {
                addPoint(p.main, p.status, p.who);
                const currentMainId = mainPointCounter;
                p.subs.forEach(s => addSubPoint(currentMainId, s));
            });
            updatePreview();
        }

        // --- PREVIEW RENDERING ---
        window.updatePreview = function() {
            // Update Header
            const fields = ['tajuk', 'tarikh', 'masa', 'tempat', 'anjuran', 'nama', 'jawatan'];
            fields.forEach(id => {
                const el = document.getElementById(`out-${id}`);
                const val = document.getElementById(`in-${id}`).value;
                if(el) el.textContent = val.toUpperCase();
            });
            
            // Footer Date
            const dateVal = document.getElementById('in-tarikh').value;
            document.getElementById('out-tarikh-laporan').textContent = dateVal.toUpperCase();

            // Render Content
            const previewList = document.getElementById('out-content');
            previewList.innerHTML = '';

            const mainDivs = document.querySelectorAll('[id^="group-main-"]');
            
            mainDivs.forEach((div) => {
                const mainIdStr = div.id.replace('group-main-', '');
                const mainInput = document.getElementById(`input-main-${mainIdStr}`);
                const statusSelect = document.getElementById(`status-main-${mainIdStr}`);
                const whoInput = document.getElementById(`who-main-${mainIdStr}`);
                
                if(mainInput) {
                    const mainText = mainInput.value;
                    const status = statusSelect.value;
                    const who = whoInput.value.toUpperCase();

                    const li = document.createElement('li');
                    
                    // 1. Text Wrapper
                    const contentWrapper = document.createElement('div');
                    
                    // Main Text
                    const pMain = document.createElement('span');
                    pMain.style.fontWeight = "bold";
                    pMain.textContent = mainText;
                    contentWrapper.appendChild(pMain);

                    // Sub-points
                    const subContainer = document.getElementById(`sub-container-${mainIdStr}`);
                    const subInputs = subContainer.querySelectorAll('textarea');
                    
                    if(subInputs.length > 0) {
                        const ulSub = document.createElement('ul');
                        ulSub.style.listStyleType = "disc";
                        ulSub.style.paddingLeft = "1.5rem";
                        ulSub.style.marginTop = "0.25rem";
                        ulSub.style.fontWeight = "normal";
                        
                        let hasSubs = false;
                        subInputs.forEach(subIn => {
                            if(subIn.value.trim() !== "") {
                                const liSub = document.createElement('li');
                                liSub.style.marginBottom = "0.25rem";
                                liSub.textContent = subIn.value;
                                ulSub.appendChild(liSub);
                                hasSubs = true;
                            }
                        });
                        if(hasSubs) contentWrapper.appendChild(ulSub);
                    }
                    
                    li.appendChild(contentWrapper);

                    // 2. Status Footer (Makluman / Tindakan)
                    const statusDiv = document.createElement('div');
                    statusDiv.className = "status-tag";
                    
                    if (status === "MAKLUMAN") {
                        statusDiv.style.color = "#6b7280"; // Gray
                        statusDiv.textContent = "MAKLUMAN";
                    } else {
                        statusDiv.style.color = "#dc2626"; // Red
                        statusDiv.textContent = `TINDAKAN: ${who || "PGB"}`;
                    }
                    
                    li.appendChild(statusDiv);

                    if(mainText.trim() !== "" || li.querySelector('ul')) {
                        previewList.appendChild(li);
                    }
                }
            });
        }

        // --- EXPORT PDF ---
        window.downloadPDF = function() {
            const element = document.getElementById('pdf-wrapper');
            let tajuk = document.getElementById('in-tajuk').value;
            tajuk = tajuk.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_');
            const fileName = `SPARK_CURAI_${tajuk}.pdf`;

            const opt = {
                margin: 0,
                filename: fileName,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>
