<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK â€“ Penilaian Program</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .card { 
            background-color: white; 
            border-radius: 0.75rem; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); 
        }
        .btn { transition: background-color 0.3s, transform 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { cursor: not-allowed; opacity: 0.7; }
        @keyframes pulse-animation { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .logo-pulse { animation: pulse-animation 2s infinite; }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <a href="index.html" class="flex flex-col">
                        <span class="text-2xl font-bold text-indigo-600">SPARK</span>
                        <span class="text-xs text-gray-500 -mt-1">Percikan Inovasi Kehadiran Digital</span>
                    </a>
                </div>
                <div class="flex items-center">
                    <a href="index.html" class="text-gray-600 hover:text-indigo-600 p-2 rounded-full hover:bg-gray-100" title="Halaman Utama">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content" class="w-full max-w-2xl mx-auto flex-grow flex items-center justify-center p-4">
        <div class="w-full">
            <div id="loading-state" class="text-center">
                <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                <p class="mt-2 text-gray-600">Memuatkan borang penilaian...</p>
            </div>

            <div id="ic-card" class="card p-8 hidden">
                <div class="text-center mb-6">
                    <h1 id="program-name" class="text-2xl font-bold text-gray-800"></h1>
                    <p id="program-date" class="text-sm text-gray-500 mt-1"></p>
                </div>
                
                <form id="ic-form" onsubmit="handleIcSubmit(event)">
                    <label for="participant-ic" class="block text-sm font-medium text-gray-700 mb-2">Sila Masukkan No. IC Anda Untuk Mula</label>
                    <input type="tel" id="participant-ic" required placeholder="Contoh: 900101131234 (tanpa sengkang)" maxlength="12" oninput="validateIcInput(this)" class="block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg tracking-wider">
                    <div class="text-right text-xs text-gray-500 mt-1 pr-1"><span id="ic-counter">0</span>/12</div>
                    <button type="submit" id="submit-ic-btn" class="btn w-full mt-4 bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg text-base">Seterusnya</button>
                </form>
            </div>

            <div id="evaluation-form-card" class="card p-8 hidden">
                <h3 class="text-xl font-semibold mb-1">Soal Selidik Penilaian Program</h3>
                <p id="evaluator-name" class="text-gray-600 mb-6"></p>
                
                <div class="p-4 bg-gray-50 rounded-lg mb-6 border">
                    <h4 class="text-sm font-semibold text-gray-800">SKALA PENILAIAN</h4>
                    <p class="text-xs text-gray-600 mt-1">1-Sangat Tidak Setuju, 2-Tidak Setuju, 3-Kurang Setuju, 4-Setuju, 5-Sangat Setuju</p>
                </div>

                <form id="evaluation-form" onsubmit="submitEvaluation(event)" class="max-h-[60vh] overflow-y-auto pr-2">
                    <div id="questions-container" class="space-y-6">
                    </div>
                    <button type="submit" id="submit-evaluation-btn" class="btn w-full mt-8 bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg">Hantar Penilaian</button>
                </form>
            </div>

            <div id="message-card" class="card p-8 text-center hidden">
                 <div id="message-icon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"></div>
                <h2 id="message-title" class="text-2xl font-bold"></h2>
                <p id="message-body" class="text-gray-600 mt-2"></p>
                <div id="cert-button-container" class="mt-6 hidden">
                    <button onclick="printCertificate()" class="btn inline-flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" />
                        </svg>
                        Cetak Sijil
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t mt-12">
        <div class="container mx-auto px-6 py-4 text-center text-gray-600 text-sm">
            <p>Projek Inovasi oleh Pahan</p>
            <p class="text-xs text-gray-500 mt-1">Versi 2.1 (2025)</p>
        </div>
    </footer>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, updateDoc, arrayUnion, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM", authDomain: "myqrhadir.firebaseapp.com", projectId: "myqrhadir", storageBucket: "myqrhadir.appspot.com", messagingSenderId: "799691133747", appId: "1:799691133747:web:835a5e3e9413eace806446" };
        
        let db, auth;
        let currentProgram = null;
        let participantInfo = null;
        const appId = firebaseConfig.projectId;

        const evaluationQuestions = [
            "Pengurusan teratur", "Lokasi sesuai", "Program ini mampu meningkatkan prestasi kerja saya",
            "Program ini mampu memberi keyakinan kepada saya dalam memberi perkhidmatan", "Tempoh masa program mencukupi",
            "Saya bersedia untuk memberi kursus dalaman", "Bahan perkongsian berguna dan membantu",
            "Bahan perkongsian mudah difahami dan jelas", "Isi kandungan sesuai dengan objektif dan menepati tajuk",
            "Isi kandungan mampu meningkatkan percambahan ilmu saya", "Isi kandungan membantu saya mengamalkannya dalam tugas seharian",
            "Penyampaian amat jelas", "Bahasa yang digunakan mudah difahami", "Interaksi penceramah/fasilitator adalah sesuai",
            "Penceramah/fasilitator bersifat bersedia, yakin dan terbuka", "Penampilan penceramah/fasilitator adalah sesuai dan profesional",
            "Penceramah/fasilitator menepati masa", "Penceramah/fasilitator menggunakan masa secara optimum"
        ];

        try { const app = initializeApp(firebaseConfig); db = getFirestore(app); auth = getAuth(app); } catch (e) { console.error("Error initializing Firebase:", e); }
        
        onAuthStateChanged(auth, async (user) => { if (user) main(); else { try { await signInAnonymously(auth); } catch (error) { console.error("Error signing in:", error); } } });

        async function main() {
            const urlParams = new URLSearchParams(window.location.search);
            const evaluationKey = urlParams.get('kod');
            
            if (!evaluationKey) { return showMessage('error', 'Pautan Tidak Sah', 'Kod penilaian tidak ditemui dalam pautan.'); }

            const programsRef = collection(db, `artifacts/${appId}/public/data/spark_programs`);
            const q = query(programsRef, where("evaluationKey", "==", evaluationKey));
            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                const programDoc = querySnapshot.docs[0];
                currentProgram = { id: programDoc.id, ...programDoc.data() };
                document.getElementById('program-name').textContent = `Penilaian Program: ${currentProgram.name}`;
                document.getElementById('program-date').textContent = new Date(currentProgram.startDate).toLocaleDateString('ms-MY', { day: 'numeric', month: 'long', year: 'numeric' });
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('ic-card').classList.remove('hidden');
            } else { showMessage('error', 'Penilaian Tidak Ditemui', 'Sila pastikan anda menggunakan pautan yang betul.'); }
        }

        function renderEvaluationForm() {
            const container = document.getElementById('questions-container');
            let html = '';
            evaluationQuestions.forEach((q_text, index) => {
                const q_index = index + 1;
                html += `
                    <div class="pt-4 border-t first:border-t-0">
                        <label class="block text-sm font-medium text-gray-700">${q_index}. ${q_text}</label>
                        <div class="flex justify-between items-center mt-2 text-xs text-gray-500">
                            <span>Sangat Tidak Setuju</span>
                            <span>Sangat Setuju</span>
                        </div>
                        <div class="flex justify-between items-center mt-1 space-x-2">
                            ${[1,2,3,4,5].map(val => `
                                <label class="flex flex-col items-center flex-1 cursor-pointer p-2 rounded-lg hover:bg-indigo-50">
                                    <input type="radio" name="q${q_index}" value="${val}" class="h-5 w-5 text-indigo-600 border-gray-300 focus:ring-indigo-500" required>
                                    <span class="mt-1 text-sm font-semibold">${val}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            html += `
                <div class="pt-4 border-t">
                    <label for="suggestion-textarea" class="block text-sm font-medium text-gray-700">${evaluationQuestions.length + 1}. Kekuatan/Cadangan Penambahbaikan (Jika ada)</label>
                    <textarea id="suggestion-textarea" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                </div>
            `;
            container.innerHTML = html;
        }

        function validateIcInput(input) {
            input.value = input.value.replace(/[^0-9]/g, '');
            const counter = document.getElementById('ic-counter');
            const currentLength = input.value.length;
            counter.textContent = currentLength;
             if (currentLength === 12) {
                counter.classList.add('text-green-600', 'font-bold');
            } else {
                counter.classList.remove('text-green-600', 'font-bold');
            }
        }

        window.handleIcSubmit = async function(event) {
            event.preventDefault();
            const icInput = document.getElementById('participant-ic');
            const ic = icInput.value.trim();
            if (!ic || ic.length !== 12) { alert("Sila masukkan No. IC yang sah (12 digit nombor sahaja)."); return; }

            const submitBtn = document.getElementById('submit-ic-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

            const isAlreadyEvaluated = (currentProgram.evaluations || []).some(p => p.ic === ic);
            if (isAlreadyEvaluated) { return showMessage('warning', 'Telah Menjawab', 'Anda telah pun memberi maklum balas penilaian untuk program ini.'); }

            const participantsRef = collection(db, `artifacts/${appId}/public/data/spark_participants`);
            const q = query(participantsRef, where("ic", "==", ic));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                submitBtn.disabled = false;
                submitBtn.textContent = "Seterusnya";
                return alert("No. IC anda tidak ditemui dalam rekod. Sila pastikan anda telah mendaftar kehadiran untuk program ini.");
            }
            
            const participantData = querySnapshot.docs[0].data();
            participantInfo = { ic: ic, name: participantData.name };
            
            renderEvaluationForm();
            document.getElementById('evaluator-name').textContent = `Nama Penilai: ${participantInfo.name}`;
            document.getElementById('ic-card').classList.add('hidden');
            document.getElementById('evaluation-form-card').classList.remove('hidden');
        }

        window.submitEvaluation = async function(event) {
            event.preventDefault();
            const submitBtn = document.getElementById('submit-evaluation-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = "Menghantar...";

            if (!participantInfo) {
                showMessage('error', 'Ralat', 'Maklumat peserta tidak ditemui.');
                submitBtn.disabled = false;
                submitBtn.textContent = "Hantar Penilaian";
                return;
            }
            
            const responses = {};
            for (let i = 1; i <= evaluationQuestions.length; i++) {
                const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                if (!checkedRadio) {
                    alert(`Sila jawab soalan nombor ${i}.`);
                    submitBtn.disabled = false;
                    submitBtn.textContent = "Hantar Penilaian";
                    document.querySelector(`input[name="q${i}"]`).closest('div.pt-4').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return; 
                }
                responses[`q${i}`] = parseInt(checkedRadio.value, 10);
            }

            const newEvaluation = {
                ic: participantInfo.ic, name: participantInfo.name,
                time: new Date().toISOString(),
                responses: responses,
                suggestion: document.getElementById('suggestion-textarea').value.trim()
            };

            const programRef = doc(db, `artifacts/${appId}/public/data/spark_programs`, currentProgram.id);
            try {
                await updateDoc(programRef, { evaluations: arrayUnion(newEvaluation) });

                if (currentProgram.eCertificateNeeded) {
                    const successTitle = `Tahniah, ${participantInfo.name}!`;
                    const successBody = "Penilaian anda telah diterima. Terima kasih kerana menggunakan SPARK - Percikan Inovasi Kehadiran Digital.";
                    showMessage('success', successTitle, successBody, true);
                } else {
                    showMessage('success', 'Penilaian Diterima!', `Terima kasih, ${participantInfo.name}. Maklum balas anda amat kami hargai.`);
                }
            } catch(error) {
                console.error("Error saving evaluation: ", error);
                showMessage('error', 'Gagal', 'Gagal menyimpan penilaian. Sila cuba lagi.');
                submitBtn.disabled = false;
                submitBtn.textContent = "Hantar Penilaian";
            }
        }

        function showMessage(type, title, body, showCertButton = false) {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('ic-card').classList.add('hidden');
            document.getElementById('evaluation-form-card').classList.add('hidden');
            const msgCard = document.getElementById('message-card');
            const msgIcon = document.getElementById('message-icon');
            const msgTitle = document.getElementById('message-title');
            const msgBody = document.getElementById('message-body');
            msgTitle.textContent = title;
            msgBody.textContent = body;
            
            const certButtonContainer = document.getElementById('cert-button-container');
            if (showCertButton) {
                certButtonContainer.classList.remove('hidden');
            } else {
                certButtonContainer.classList.add('hidden');
            }

            let icon, color;
            if (type === 'success') { icon = `<svg class="h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`; color = 'bg-green-500'; } 
            else if (type === 'warning') { icon = `<svg class="h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`; color = 'bg-yellow-500'; } 
            else { icon = `<svg class="h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`; color = 'bg-red-500'; }
            msgIcon.className = `w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 ${color}`;
            msgIcon.innerHTML = icon;
            msgCard.classList.remove('hidden');
        }
        
        function printCertificate() {
            if (!participantInfo || !currentProgram) return;

            const participantName = participantInfo.name.toUpperCase();
            const participantIC = participantInfo.ic;
            const courseName = currentProgram.name.toUpperCase();
            
            const startDate = new Date(currentProgram.startDate + 'T00:00:00');
            const endDate = new Date(currentProgram.endDate + 'T00:00:00');
            let dateString;
            
            if (startDate.getTime() === endDate.getTime()) {
                dateString = `pada ${startDate.toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' }).toUpperCase()}`;
            } else {
                dateString = `pada ${startDate.toLocaleDateString('ms-MY', { day: '2-digit' })} hingga ${endDate.toLocaleDateString('ms-MY', { day: '2-digit', month: 'long', year: 'numeric' }).toUpperCase()}`;
            }

            const serialNumber = `SPK/${currentProgram.id}/${participantIC.slice(-4)}`;
            const validationUrl = `${window.location.origin}${window.location.pathname.replace('penilaianprogram.html', 'sijil.html')}?siri=${encodeURIComponent(serialNumber)}`;
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(validationUrl)}`;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ms">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Sijil Penyertaan - ${participantName}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@700&display=swap');
                        body { font-family: 'Montserrat', sans-serif; font-weight: 400; margin: 0; padding: 0; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #333; }
                        .certificate-container { width: 210mm; height: 297mm; background-color: white; padding: 12mm; box-sizing: border-box; position: relative; display: flex; flex-direction: column; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); overflow: hidden; }
                        .certificate-container::before, .certificate-container::after { content: ''; position: absolute; width: 170px; height: 170px; background-color: #4B40FF; opacity: 0.9; z-index: 1; }
                        .certificate-container::before { top: -85px; left: -85px; transform: rotate(45deg); }
                        .certificate-container::after { bottom: -85px; right: -85px; transform: rotate(45deg); }
                        .certificate-content { border: 6px solid; border-image-slice: 1; border-image-source: linear-gradient(to right top, #d4af37, #4B40FF, #d4af37); height: 100%; padding: 10mm; box-sizing: border-box; position: relative; z-index: 2; display: flex; flex-direction: column; background: #ffffff; }
                        .header-section { display: flex; justify-content: space-between; align-items: flex-start; width: 100%; height: 75px; }
                        .qr-code { width: 65px; height: 65px; }
                        .serial-number { font-family: 'Courier New', Courier, monospace; font-size: 14px; color: #555; margin: 0; }
                        .logo { width: 150px; height: auto; margin: 0 auto 15px auto; }
                        h1 { font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 700; margin: 15px 0; letter-spacing: 1.5px; text-transform: uppercase; background: linear-gradient(45deg, #4B40FF, #a8871a, #4B40FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
                        .intro-text { font-size: 16px; margin-top: 25px; margin-bottom: 20px; color: #555; }
                        .recipient-name { font-family: 'Playfair Display', serif; font-size: 30px; font-weight: 700; margin: 10px 0; color: #c59d1e; }
                        .recipient-ic { font-size: 16px; font-weight: 500; margin-bottom: 30px; color: #444; }
                        .event-title-label { font-size: 16px; color: #555; }
                        .event-title { font-size: 22px; font-weight: 700; font-style: italic; margin: 10px 0; color: #111; }
                        .event-date { font-size: 16px; font-weight: 500; margin-top: 10px; margin-bottom: 40px; color: #444; }
                        .divider { width: 100px; height: 2px; background: linear-gradient(90deg, #d4af37, #4B40FF); margin: 0 auto 20px auto; border: none; }
                        .signature-section { margin-top: auto; }
                        .signatory-name { font-weight: 700; font-size: 16px; letter-spacing: 1px; text-transform: uppercase; background: linear-gradient(90deg, #4B40FF, #3a32cc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
                        .signatory-title { font-size: 14px; font-weight: 500; line-height: 1.5; color: #333; }
                        .footer-note { font-size: 10px; font-style: italic; margin-top: 25px; color: #999; }
                        .spark-section { margin-top: 15px; }
                        .spark-title { font-weight: 700; font-size: 14px; letter-spacing: 2px; background: linear-gradient(90deg, #4B40FF, #3a32cc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
                        .spark-subtitle { font-size: 10px; color: #555; margin: 4px 0 0 0; font-style: italic; }
                        @media print {
                            body { background-color: white; }
                            .certificate-container { box-shadow: none; margin: 0; }
                            @page { size: A4 portrait; margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="certificate-container">
                        <div class="certificate-content">
                            <div class="header-section">
                                <img src="${qrCodeUrl}" alt="QR Code" class="qr-code">
                                <p class="serial-number">NO. SIRI: ${serialNumber}</p>
                            </div>
                            <img src="https://i.imgur.com/FQpwGDo.png" alt="Logo Pejabat Pendidikan Daerah Miri" class="logo">
                            <h1>Sijil Penyertaan</h1>
                            <p class="intro-text">Dengan ini disahkan bahawa</p>
                            <p class="recipient-name">${participantName}</p>
                            <p class="recipient-ic">${participantIC}</p>
                            <p class="event-title-label">telah mengikuti</p>
                            <p class="event-title">${courseName}</p>
                            <p class="event-date">${dateString}</p>
                            <hr class="divider">
                            <div class="signature-section">
                                <p class="signatory-name">MARIAM HAJI MONEK</p>
                                <p class="signatory-title">PEGAWAI PENDIDIKAN DAERAH,<br>PEJABAT PENDIDIKAN DAERAH MIRI.</p>
                            </div>
                            <p class="footer-note">Sijil ini adalah cetakan komputer, tandatangan tidak diperlukan.</p>
                            <div class="spark-section">
                                <p class="spark-title">SPARK</p>
                                <p class="spark-subtitle">Percikan Inovasi Kehadiran Digital</p>
                            </div>
                        </div>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.onload = function() { 
                printWindow.focus(); 
                printWindow.print();
            };
        }
        
        window.validateIcInput = validateIcInput;
        window.printCertificate = printCertificate;
    </script>
</body>
</html>
