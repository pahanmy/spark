<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK – Kajian Keperluan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f8f9fa; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn:disabled { cursor: not-allowed; opacity: 0.6; transform: none; }
        
        /* Custom radio/checkbox styles for a more modern look */
        .form-radio, .form-checkbox {
            appearance: none;
            display: inline-block;
            vertical-align: middle;
            height: 1.25rem;
            width: 1.25rem;
            flex-shrink: 0;
            border-radius: 0.25rem;
            border: 2px solid #cbd5e1;
            transition: all 0.2s;
        }
        .form-radio { border-radius: 9999px; }
        .form-radio:checked, .form-checkbox:checked {
            background-color: #4f46e5;
            border-color: #4f46e5;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }
        .form-radio:focus, .form-checkbox:focus { box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3); outline: none; }

        .choice-label {
            display: block;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .choice-label:has(input:checked) {
            border-color: #4f46e5;
            background-color: #eef2ff;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }
        
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .progress-bar {
            height: 0.75rem;
            background-color: #4f46e5;
            width: 0%;
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50">

    <header class="bg-white shadow-sm w-full">
        <div class="max-w-5xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-lg"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white"><path d="M4 4H8V8H4V4Z" fill="currentColor"></path><path d="M4 16H8V20H4V16Z" fill="currentColor"></path><path d="M16 4H20V8H16V4Z" fill="currentColor"></path><path d="M10 4H14V6H10V4Z" fill="currentColor"></path><path d="M10 8H12V10H10V8Z" fill="currentColor"></path><path d="M12 12H14V14H12V12Z" fill="currentColor"></path><path d="M10 16H12V18H10V16Z" fill="currentColor"></path><path d="M14 16H16V18H14V16Z" fill="currentColor"></path><path d="M16 12H18V14H16V12Z" fill="currentColor"></path><path d="M16 8H20V10H16V8Z" fill="currentColor"></path><path d="M12 18H14V20H12V18Z" fill="currentColor"></path><path d="M4 10H6V14H4V10Z" fill="currentColor"></path></svg></div>
                <div>
                    <h1 class="text-2xl font-bold text-indigo-600">SPARK</h1>
                    <p class="text-sm text-gray-500">Percikan Inovasi Kehadiran Digital</p>
                </div>
            </div>
             <a href="index.html" class="btn bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-300 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" /></svg>
                Halaman Utama
             </a>
        </div>
    </header>

    <main class="w-full max-w-3xl mx-auto p-4">
        
        <div id="survey-card" class="card p-6 md:p-10">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Borang Tinjauan</h2>
                <p class="mt-2 text-gray-600">Kajian Keperluan Pengurusan Kehadiran Program di Peringkat Sekolah / PPD</p>
            </div>
            
            <div class="progress-bar-container my-8">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <form id="kajian-form" onsubmit="submitSurvey(event)" class="space-y-10">

                <fieldset class="space-y-6">
                    <legend class="text-xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-2 w-full">Bahagian A: Maklumat Responden</legend>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">1. Jawatan / Peranan:</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="jawatan" value="Guru" class="form-radio" required><span>Guru</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="jawatan" value="Pentadbir" class="form-radio"><span>Pentadbir</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="jawatan" value="Urus setia program" class="form-radio"><span>Urus setia program</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="jawatan" value="Lain-lain" class="form-radio" onchange="toggleConditionalInput(this, 'jawatan-lain-input')"><span>Lain-lain</span></label>
                            <input type="text" id="jawatan-lain-input" name="jawatan-lain" placeholder="Sila nyatakan..." class="mt-2 ml-8 w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md hidden">
                        </div>
                    </div>

                    <div>
                        <label for="tempat-bertugas" class="block text-md font-semibold text-gray-700 mb-2">2. Tempat bertugas:</label>
                        <input type="text" id="tempat-bertugas" name="tempat-bertugas" class="block w-full px-4 py-2 border border-gray-300 rounded-md" required>
                    </div>

                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">3. Pengalaman mengurus program (tahun):</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="choice-label text-center"><input type="radio" name="pengalaman" value="< 1 tahun" class="sr-only" required><span>&lt; 1 tahun</span></label>
                            <label class="choice-label text-center"><input type="radio" name="pengalaman" value="1-3 tahun" class="sr-only"><span>1–3 tahun</span></label>
                            <label class="choice-label text-center"><input type="radio" name="pengalaman" value="4-6 tahun" class="sr-only"><span>4–6 tahun</span></label>
                            <label class="choice-label text-center"><input type="radio" name="pengalaman" value="> 6 tahun" class="sr-only"><span>&gt; 6 tahun</span></label>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="space-y-6">
                    <legend class="text-xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-2 w-full">Bahagian B: Proses Sedia Ada</legend>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">4. Langkah yang biasanya anda lakukan apabila ingin mengurus kehadiran program: (Boleh pilih lebih dari satu)</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="langkah_sedia_ada" value="Membina Google Form" class="form-checkbox"><span>Membina Google Form / borang digital</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="langkah_sedia_ada" value="Menjana kod QR manual" class="form-checkbox"><span>Menjana kod QR secara manual</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="langkah_sedia_ada" value="Mengedarkan pautan" class="form-checkbox"><span>Mengedarkan pautan melalui WhatsApp / surat</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="langkah_sedia_ada" value="Menyediakan senarai tandatangan" class="form-checkbox"><span>Menyediakan senarai tandatangan kehadiran</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="langkah_sedia_ada" value="Menyediakan laporan manual" class="form-checkbox"><span>Menyediakan laporan kehadiran manual / Excel</span></label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">5. Purata masa diambil untuk menyediakan sistem kehadiran sebelum program bermula:</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="choice-label text-center"><input type="radio" name="masa_penyediaan" value="< 15 minit" class="sr-only" required><span>&lt; 15 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_penyediaan" value="15-30 minit" class="sr-only"><span>15–30 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_penyediaan" value="30-60 minit" class="sr-only"><span>30–60 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_penyediaan" value="> 1 jam" class="sr-only"><span>&gt; 1 jam</span></label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">6. Adakah anda menyediakan borang tinjauan awal (RSVP)?</label>
                        <div class="flex gap-4">
                            <label class="choice-label flex-1 text-center"><input type="radio" name="rsvp" value="Ya" class="sr-only" required><span>Ya</span></label>
                            <label class="choice-label flex-1 text-center"><input type="radio" name="rsvp" value="Tidak" class="sr-only"><span>Tidak</span></label>
                        </div>
                    </div>

                     <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">7. Bagaimana anda merekodkan maklumat pengganti?</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_pengganti" value="Kemas kini manual" class="form-radio" required><span>Kemas kini manual dalam Google Form / Excel</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_pengganti" value="Catat semasa program" class="form-radio"><span>Catat semasa program</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_pengganti" value="Tidak direkodkan" class="form-radio"><span>Tidak direkodkan secara rasmi</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_pengganti" value="Lain-lain" class="form-radio" onchange="toggleConditionalInput(this, 'pengganti-lain-input')"><span>Lain-lain</span></label>
                            <input type="text" id="pengganti-lain-input" name="pengganti-lain" placeholder="Sila nyatakan..." class="mt-2 ml-8 w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md hidden">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">8. Adakah anda perlu menjana kod QR baharu untuk dikongsi dalam slaid pembentangan, selain daripada pautan kehadiran sedia ada?</label>
                        <div class="flex gap-4">
                            <label class="choice-label flex-1 text-center"><input type="radio" name="qr_slide" value="Ya" class="sr-only" required><span>Ya</span></label>
                            <label class="choice-label flex-1 text-center"><input type="radio" name="qr_slide" value="Tidak" class="sr-only"><span>Tidak</span></label>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">9. Adakah anda mencetak nama program dan kod QR pada kertas untuk ditampal di lokasi program?</label>
                        <div class="flex gap-4">
                            <label class="choice-label flex-1 text-center"><input type="radio" name="qr_cetak" value="Ya" class="sr-only" required><span>Ya</span></label>
                            <label class="choice-label flex-1 text-center"><input type="radio" name="qr_cetak" value="Tidak" class="sr-only"><span>Tidak</span></label>
                        </div>
                    </div>
                </fieldset>

                 <fieldset class="space-y-6">
                    <legend class="text-xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-2 w-full">Bahagian C: Rekod Semasa Program</legend>
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">10. Kaedah utama digunakan semasa program:</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kaedah_semasa_program" value="Tandatangan manual" class="form-radio" required><span>Tandatangan manual</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kaedah_semasa_program" value="Imbas kod QR" class="form-radio"><span>Imbas kod QR (Google Form / SPLG KPM)</span></label>
                             <label class="choice-label flex items-center gap-3"><input type="radio" name="kaedah_semasa_program" value="Borang Excel / Aplikasi" class="form-radio"><span>Borang Excel / Aplikasi lain</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kaedah_semasa_program" value="Lain-lain" class="form-radio" onchange="toggleConditionalInput(this, 'kaedah-lain-input')"><span>Lain-lain</span></label>
                            <input type="text" id="kaedah-lain-input" name="kaedah-lain" placeholder="Sila nyatakan..." class="mt-2 ml-8 w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md hidden">
                        </div>
                    </div>
                     <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">11. Adakah semua peserta berjaya rekod kehadiran tanpa masalah?</label>
                        <div class="flex gap-4">
                            <label class="choice-label flex-1 text-center"><input type="radio" name="rekod_berjaya" value="Ya" class="sr-only" required onchange="toggleConditionalInput(this, 'masalah-rekod-input', false)"><span>Ya</span></label>
                            <label class="choice-label flex-1 text-center"><input type="radio" name="rekod_berjaya" value="Tidak" class="sr-only" onchange="toggleConditionalInput(this, 'masalah-rekod-input', true)"><span>Tidak</span></label>
                        </div>
                         <textarea id="masalah-rekod-input" name="masalah-rekod" rows="2" placeholder="Sila nyatakan masalah yang dihadapi..." class="mt-3 w-full px-3 py-2 border border-gray-300 rounded-md hidden"></textarea>
                    </div>
                </fieldset>

                <fieldset class="space-y-6">
                    <legend class="text-xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-2 w-full">Bahagian D: Pengalaman SPLG KPM</legend>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">12. Berapa kerap anda menggunakan SPLG KPM?</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kerap_splg" value="Sangat kerap (>5 kali sebulan)" class="form-radio" required><span>Sangat kerap (>5 kali sebulan)</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kerap_splg" value="Kerap (2-4 kali sebulan)" class="form-radio"><span>Kerap (2-4 kali sebulan)</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kerap_splg" value="Kadang-kadang (Sebulan sekali)" class="form-radio"><span>Kadang-kadang (Sebulan sekali)</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="kerap_splg" value="Jarang / Hanya bila diarahkan" class="form-radio"><span>Jarang / Hanya bila diarahkan</span></label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">13. Apakah cabaran utama semasa menggunakan SPLG KPM? (Boleh pilih lebih dari satu)</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="cabaran_splg" value="Laman web lambat" class="form-checkbox"><span>Laman web lambat / sering log keluar</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="cabaran_splg" value="QR sukar dijana" class="form-checkbox"><span>QR sukar dijana / diakses</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="cabaran_splg" value="Proses muat naik Excel lambat" class="form-checkbox"><span>Proses muat naik Excel mengambil masa</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="cabaran_splg" value="Tidak semua program diterima" class="form-checkbox"><span>Tidak semua program diterima sistem</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="checkbox" name="cabaran_splg" value="Lain-lain" class="form-checkbox" onchange="toggleConditionalInput(this, 'cabaran-lain-input')"><span>Lain-lain</span></label>
                             <input type="text" id="cabaran-lain-input" name="cabaran-lain" placeholder="Sila nyatakan..." class="mt-2 ml-8 w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md hidden">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">14. Purata masa untuk siapkan laporan kehadiran selepas program tamat:</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="choice-label text-center"><input type="radio" name="masa_laporan" value="< 10 minit" class="sr-only" required><span>&lt; 10 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_laporan" value="10-30 minit" class="sr-only"><span>10–30 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_laporan" value="30-60 minit" class="sr-only"><span>30–60 minit</span></label>
                            <label class="choice-label text-center"><input type="radio" name="masa_laporan" value="> 1 jam" class="sr-only"><span>&gt; 1 jam</span></label>
                        </div>
                    </div>
                    
                     <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">15. Adakah anda pernah ingin rekod kehadiran untuk program tidak rasmi (cth: Bacaan Yasin, Gotong-royong)?</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_tak_rasmi" value="Ya, kerap (>5 kali sebulan)" class="form-radio" required><span>Ya, kerap (>5 kali sebulan)</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_tak_rasmi" value="Kadang-kadang (1-4 kali sebulan)" class="form-radio"><span>Kadang-kadang (1-4 kali sebulan)</span></label>
                             <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_tak_rasmi" value="Jarang (< 1 kali sebulan)" class="form-radio"><span>Jarang (&lt; 1 kali sebulan)</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="rekod_tak_rasmi" value="Tidak pernah" class="form-radio"><span>Tidak pernah</span></label>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="space-y-6">
                    <legend class="text-xl font-semibold text-indigo-700 border-b-2 border-indigo-200 pb-2 w-full">Bahagian E: Cadangan & Harapan</legend>
                    
                     <div>
                        <label class="block text-md font-semibold text-gray-700 mb-3">16. Sekiranya ada sistem yang boleh merekod semua jenis program (rasmi & tidak rasmi) dengan satu imbasan QR, adakah anda akan menggunakannya?</label>
                        <div class="space-y-3">
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="minat_sistem_baru" value="Sangat setuju / Pasti guna" class="form-radio" required><span>Sangat setuju / Pasti guna</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="minat_sistem_baru" value="Setuju" class="form-radio"><span>Setuju</span></label>
                            <label class="choice-label flex items-center gap-3"><input type="radio" name="minat_sistem_baru" value="Tidak pasti" class="form-radio"><span>Tidak pasti</span></label>
                             <label class="choice-label flex items-center gap-3"><input type="radio" name="minat_sistem_baru" value="Tidak setuju" class="form-radio"><span>Tidak setuju</span></label>
                        </div>
                    </div>

                    <div>
                        <label for="harapan_ideal" class="block text-md font-semibold text-gray-700 mb-2">17. Dalam satu ayat, apakah yang anda harapkan ada dalam sistem kehadiran digital ideal anda?</label>
                        <textarea id="harapan_ideal" name="harapan_ideal" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                    </div>
                     <div>
                        <label for="cadangan_tambahan" class="block text-md font-semibold text-gray-700 mb-2">18. Cadangan tambahan untuk penambahbaikan sistem kehadiran digital:</label>
                        <textarea id="cadangan_tambahan" name="cadangan_tambahan" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                    </div>

                </fieldset>

                <div class="pt-6 border-t">
                    <button type="submit" id="submit-btn" class="btn w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg text-lg">Hantar Tinjauan</button>
                </div>
            </form>
        </div>

        <div id="thank-you-card" class="hidden card p-10 text-center">
            <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h2 class="text-3xl font-bold text-gray-800">Syabas!</h2>
            <p class="mt-3 text-gray-600">Terima kasih atas jawapan anda. Anda adalah orang yang ke-<span id="response-count" class="font-bold"></span> mengisi tinjauan ini. Kami amat menghargai masa dan input yang anda berikan.</p>
            <a href="index.html" class="btn inline-block mt-8 bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg">Kembali ke Halaman Utama</a>
        </div>

    </main>

    <footer class="text-center py-4 mt-8 w-full">
        <p class="text-sm text-gray-600">Dibangunkan oleh <a href="https://pahanmy.github.io/works/" target="_blank" class="font-semibold text-indigo-600 hover:underline">Pahan</a></p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM",
            authDomain: "myqrhadir.firebaseapp.com",
            projectId: "myqrhadir",
            storageBucket: "myqrhadir.appspot.com",
            messagingSenderId: "799691133747",
            appId: "1:799691133747:web:835a5e3e9413eace806446"
        };
        
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch (e) {
            console.error("Error initializing Firebase:", e);
        }

        const form = document.getElementById('kajian-form');
        const progressBar = document.getElementById('progress-bar');
        const fieldsets = form.querySelectorAll('fieldset');
        const totalFieldsets = fieldsets.length;
        
        // Update progress bar on input change
        form.addEventListener('change', () => {
            let answeredCount = 0;
            fieldsets.forEach(fieldset => {
                const inputs = fieldset.querySelectorAll('input[required], textarea[required]');
                let isAnswered = true;
                if (inputs.length > 0) {
                    isAnswered = Array.from(inputs).every(input => {
                         if (input.type === 'radio') {
                            const radioGroup = form.querySelectorAll(`input[name="${input.name}"]`);
                            return Array.from(radioGroup).some(radio => radio.checked);
                        }
                        return input.value.trim() !== '';
                    });
                }
                
                if (isAnswered) {
                    answeredCount++;
                }
            });
            
            const progress = (answeredCount / totalFieldsets) * 100;
            progressBar.style.width = `${progress}%`;
        });

        window.toggleConditionalInput = (trigger, inputId, showOnChecked = true) => {
            const inputElement = document.getElementById(inputId);
            if (trigger.checked === showOnChecked) {
                inputElement.classList.remove('hidden');
            } else {
                inputElement.classList.add('hidden');
                inputElement.value = '';
            }
        };

        window.submitSurvey = async (event) => {
            event.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Menghantar...';
            
            // Get current count before adding new doc
            const responsesRef = collection(db, `artifacts/${firebaseConfig.projectId}/public/data/spark_kajian_responses`);
            const snapshot = await getDocs(responsesRef);
            const currentCount = snapshot.size;

            const formData = new FormData(form);
            const surveyData = {};

            formData.forEach((value, key) => {
                if (!key.endsWith('-lain')) {
                    surveyData[key] = value;
                }
            });

            // Consolidate 'Lain-lain' fields
            const jawatanLain = formData.get('jawatan-lain');
            if (surveyData.jawatan === 'Lain-lain' && jawatanLain) { surveyData.jawatan = `Lain-lain: ${jawatanLain}`; }
            const penggantiLain = formData.get('pengganti-lain');
            if (surveyData.rekod_pengganti === 'Lain-lain' && penggantiLain) { surveyData.rekod_pengganti = `Lain-lain: ${penggantiLain}`; }
            const kaedahLain = formData.get('kaedah-lain');
            if (surveyData.kaedah_semasa_program === 'Lain-lain' && kaedahLain) { surveyData.kaedah_semasa_program = `Lain-lain: ${kaedahLain}`; }

            // Handle checkboxes
            const langkahCheckboxes = form.querySelectorAll('input[name="langkah_sedia_ada"]:checked');
            surveyData.langkah_sedia_ada = Array.from(langkahCheckboxes).map(cb => cb.value);
            const cabaranCheckboxes = form.querySelectorAll('input[name="cabaran_splg"]:checked');
            let cabaranValues = Array.from(cabaranCheckboxes).map(cb => cb.value);
            const cabaranLain = formData.get('cabaran-lain');
            if (cabaranValues.includes('Lain-lain') && cabaranLain) {
                cabaranValues = cabaranValues.filter(v => v !== 'Lain-lain');
                cabaranValues.push(`Lain-lain: ${cabaranLain}`);
            }
            surveyData.cabaran_splg = cabaranValues;
            surveyData.timestamp = serverTimestamp();

            try {
                await addDoc(responsesRef, surveyData);
                document.getElementById('response-count').textContent = currentCount + 1;
                document.getElementById('survey-card').classList.add('hidden');
                document.getElementById('thank-you-card').classList.remove('hidden');
            } catch (error) {
                console.error("Error submitting survey: ", error);
                alert("Gagal menghantar tinjauan. Sila cuba lagi.");
                submitBtn.disabled = false;
                submitBtn.textContent = 'Hantar Tinjauan';
            }
        };
    </script>
</body>
</html>
