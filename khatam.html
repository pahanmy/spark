<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tadarus Bulan Ramadhan, PPD Miri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase Libraries -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, onSnapshot, updateDoc, arrayUnion, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Data Constants ---
        
        // Nama Juzuk
        const juzukNames = [
            "Alif Lam Mim", "Sayaqulu", "Tilka Rusul", "Lan Tanalu", "Wal Muhsanat", 
            "La Yuhibbullah", "Wa Iza Samiu", "Wa Lau Annana", "Qalal Malao", "Wa A'lamu",
            "Ya'tazeruna", "Wa Ma Min Dabbah", "Wa Ma Ubarri'u", "Rubama", "Subhanallazi",
            "Qala Alam", "Iqtaraba", "Qad Aflaha", "Wa Qalallazina", "Amman Khalaqa",
            "Utlu Ma Uhiya", "Wa Man Yaqnut", "Wa Maliya", "Faman Azlamu", "Ilaihi Yuraddu",
            "Ha Mim", "Qala Fama Khatbukum", "Qad Sami'allah", "Tabarakallazi", "'Amma Yatasa'alun"
        ];

        // Anggaran Jumlah Ayat Per Juzuk (Untuk pengiraan bahagi)
        // Nota: Ini adalah anggaran berdasarkan pembahagian standard mashaf Uthmani
        const juzukVersesCount = [
            148, 111, 126, 131, 124, 110, 149, 142, 159, 127,
            151, 170, 154, 227, 185, 269, 190, 202, 339, 171,
            178, 169, 357, 175, 246, 195, 399, 137, 431, 564
        ];

        // --- Configuration & Safety Check ---
        
        // 1. Konfigurasi User (myqrhadir)
        const userFirebaseConfig = {
            apiKey: "AIzaSyAEBe1XF7cqaxkTNBZBoo3DBJYIuchOEkM",
            authDomain: "myqrhadir.firebaseapp.com",
            projectId: "myqrhadir",
            storageBucket: "myqrhadir.firebasestorage.app",
            messagingSenderId: "799691133747",
            appId: "1:799691133747:web:835a5e3e9413eace806446"
        };

        // 2. Setup Variables
        let firebaseConfig = userFirebaseConfig; 
        let artifactAppId = 'tadarus-default';   
        let app, auth, db;
        let isOnlineMode = false;

        try {
            if (typeof __firebase_config !== 'undefined') {
                firebaseConfig = JSON.parse(__firebase_config);
                if (typeof __app_id !== 'undefined') artifactAppId = __app_id;
            }

            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            isOnlineMode = true;
            console.log("Firebase initialized.");

        } catch (e) {
            console.warn("Error initializing Firebase. Switching to Offline Mode.", e);
        }

        // --- State Management ---
        let currentUser = null;
        let juzukData = {}; 
        let currentJuzukSelection = null; 

        // --- Init Logic ---
        async function initApp() {
            if (isOnlineMode) {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        initFirestoreListeners();
                        document.getElementById('modeIndicator').innerHTML = '<span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-[10px] font-bold border border-green-200"><i class="fas fa-cloud"></i> Online</span>';
                    }
                });
            } else {
                loadFromLocalStorage();
                document.getElementById('modeIndicator').innerHTML = '<span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-[10px] font-bold border border-gray-300"><i class="fas fa-save"></i> Local Mode</span>';
                document.getElementById('juzukContainer').innerHTML = '';
                renderList();
            }
        }

        initApp();

        // --- Data Handling ---

        function initFirestoreListeners() {
            const dataRef = collection(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data');
            
            onSnapshot(dataRef, (snapshot) => {
                const newData = {};
                snapshot.forEach(doc => {
                    newData[doc.id] = doc.data();
                });
                juzukData = newData;
                renderList();
            }, (error) => {
                console.error("Error fetching data:", error);
            });
        }

        function loadFromLocalStorage() {
            const stored = localStorage.getItem('tadarus_data_v2');
            if (stored) {
                juzukData = JSON.parse(stored);
            }
        }

        function saveToLocalStorage() {
            localStorage.setItem('tadarus_data_v2', JSON.stringify(juzukData));
            renderList();
        }

        // --- Global Functions ---
        window.openRegistrationModal = openRegistrationModal;
        window.checkIC = checkIC;
        window.confirmRegistration = confirmRegistration;
        window.toggleStatus = toggleStatus;
        window.removeParticipant = removeParticipant;
        window.copyToWhatsapp = copyToWhatsapp;
        window.closeModal = closeModal;
        window.clearAllData = clearAllData;

        // --- Calculator Logic ---
        function getDaysRemaining() {
            const targetDate = new Date("2026-03-06"); // Tarikh Sasaran: 6 Mac 2026
            const today = new Date();
            // Reset time to midnight for accurate day calculation
            today.setHours(0,0,0,0);
            
            const diffTime = targetDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            return diffDays > 0 ? diffDays : 0;
        }

        // --- SPARK Logic: Check IC (Updated: Multi-Database Search) ---
        async function checkIC() {
            const icInput = document.getElementById('modalIC').value.trim();
            const feedbackArea = document.getElementById('icFeedback');
            const nameInputContainer = document.getElementById('nameInputContainer');
            const nameInput = document.getElementById('modalName');
            const submitBtn = document.getElementById('submitBtn');

            if (icInput.length < 4) {
                feedbackArea.innerHTML = `<span class="text-red-500 text-xs">Sila masukkan No. IC/ID yang sah.</span>`;
                return;
            }

            feedbackArea.innerHTML = `<span class="text-gray-500 text-xs"><i class="fas fa-circle-notch fa-spin"></i> Mencari dalam pangkalan data...</span>`;

            if (isOnlineMode) {
                try {
                    // Carian 1: Tadarus Users (Specific to this app)
                    const userRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_users', icInput);
                    const userSnap = await getDoc(userRef);

                    if (userSnap.exists()) {
                        foundUser(userSnap.data(), "Rekod Tadarus ditemui");
                        return;
                    }

                    // Carian 2: SPARK Participants (Global/Public DB)
                    const sparkRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_participants', icInput);
                    const sparkSnap = await getDoc(sparkRef);

                    if (sparkSnap.exists()) {
                        foundUser(sparkSnap.data(), "Rekod SPARK ditemui");
                        return;
                    }

                    // Carian 3: SPARK Staff (If available)
                    const staffRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'spark_staff', icInput);
                    const staffSnap = await getDoc(staffRef);

                    if (staffSnap.exists()) {
                        foundUser(staffSnap.data(), "Rekod Staf ditemui");
                        return;
                    }

                    // Jika tiada di semua tempat
                    promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);

                } catch (e) {
                    console.error(e);
                    feedbackArea.innerHTML = `<span class="text-red-500 text-xs">Ralat sambungan. Sila cuba lagi.</span>`;
                }
            } else {
                // Offline Logic
                let foundName = null;
                Object.values(juzukData).forEach(juz => {
                    if (juz.participants) {
                        const p = juz.participants.find(p => p.ic === icInput);
                        if (p) foundName = p.name;
                    }
                });

                if (foundName) {
                    foundUser({ name: foundName }, "Rekod Lokal ditemui");
                } else {
                    promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);
                }
            }
        }

        function foundUser(data, msg) {
            const name = data.name || data.nama || data.full_name || "";
            const feedbackArea = document.getElementById('icFeedback');
            const nameInputContainer = document.getElementById('nameInputContainer');
            const nameInput = document.getElementById('modalName');
            const submitBtn = document.getElementById('submitBtn');

            if (name) {
                nameInput.value = name;
                nameInput.disabled = true; // Lock name
                nameInputContainer.classList.remove('hidden');
                feedbackArea.innerHTML = `<span class="text-green-600 text-xs font-bold"><i class="fas fa-check-circle"></i> ${msg}: ${name}</span>`;
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                promptNewUser(nameInput, nameInputContainer, feedbackArea, submitBtn);
            }
        }

        function promptNewUser(nameInput, container, feedback, btn) {
            nameInput.value = '';
            nameInput.disabled = false;
            container.classList.remove('hidden');
            feedback.innerHTML = `<span class="text-amber-600 text-xs font-bold"><i class="fas fa-info-circle"></i> Peserta Baru. Sila masukkan nama.</span>`;
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            setTimeout(() => document.getElementById('modalName').focus(), 100);
        }

        // --- Logic: Confirm Registration ---
        async function confirmRegistration() {
            const ic = document.getElementById('modalIC').value.trim();
            const name = document.getElementById('modalName').value.trim();
            const juzukId = currentJuzukSelection.toString();
            
            if (!name || !ic) return;

            const submitBtn = document.getElementById('submitBtn');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ...';
            submitBtn.disabled = true;

            const newParticipant = {
                ic: ic,
                name: name,
                status: 'reading',
                timestamp: Date.now()
            };

            if (isOnlineMode) {
                try {
                    // 1. Save User Directory (Update tadarus_users for faster lookup next time)
                    const userRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_users', ic);
                    await setDoc(userRef, { name: name, ic: ic, last_updated: new Date().toISOString() }, { merge: true });

                    // 2. Add to Juzuk
                    const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukId);
                    await setDoc(juzukRef, {
                        participants: arrayUnion(newParticipant),
                        juzuk_id: parseInt(juzukId)
                    }, { merge: true });

                    closeModal();
                    showToast(`Berjaya: ${name}`);
                } catch (e) {
                    console.error("Save error:", e);
                    alert("Gagal menyimpan ke cloud.");
                }
            } else {
                if (!juzukData[juzukId]) juzukData[juzukId] = { participants: [] };
                if (!juzukData[juzukId].participants) juzukData[juzukId].participants = [];
                
                juzukData[juzukId].participants.push(newParticipant);
                saveToLocalStorage();
                closeModal();
                showToast(`Disimpan (Lokal): ${name}`);
            }
            
            submitBtn.innerHTML = originalBtnText;
            submitBtn.disabled = false;
        }

        async function toggleStatus(juzukId, ic, currentStatus) {
            const juzukStr = juzukId.toString();
            const newStatus = currentStatus === 'done' ? 'reading' : 'done';

            if (isOnlineMode) {
                const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukStr);
                try {
                    const docSnap = await getDoc(juzukRef);
                    if (docSnap.exists()) {
                        let participants = docSnap.data().participants || [];
                        const updatedParticipants = participants.map(p => {
                            if (p.ic === ic) return { ...p, status: newStatus };
                            return p;
                        });
                        await updateDoc(juzukRef, { participants: updatedParticipants });
                    }
                } catch (e) { console.error(e); }
            } else {
                if (juzukData[juzukStr] && juzukData[juzukStr].participants) {
                    const p = juzukData[juzukStr].participants.find(p => p.ic === ic);
                    if (p) p.status = newStatus;
                    saveToLocalStorage();
                }
            }
        }

        async function removeParticipant(juzukId, ic, name) {
            if (!confirm(`Padam ${name} dari senarai?`)) return;
            const juzukStr = juzukId.toString();

            if (isOnlineMode) {
                const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', juzukStr);
                try {
                    const docSnap = await getDoc(juzukRef);
                    if (docSnap.exists()) {
                        let participants = docSnap.data().participants || [];
                        const updatedParticipants = participants.filter(p => p.ic !== ic);
                        await updateDoc(juzukRef, { participants: updatedParticipants });
                        showToast("Peserta dipadam.");
                    }
                } catch (e) { console.error(e); }
            } else {
                if (juzukData[juzukStr] && juzukData[juzukStr].participants) {
                    juzukData[juzukStr].participants = juzukData[juzukStr].participants.filter(p => p.ic !== ic);
                    saveToLocalStorage();
                    showToast("Peserta dipadam (Lokal).");
                }
            }
        }
        
        async function clearAllData() {
            if (!confirm("AWAS: Padam SEMUA data?")) return;
            if (!confirm("Tindakan ini kekal.")) return;
            
            if (isOnlineMode) {
                 for(let i=1; i<=30; i++) {
                     const juzukRef = doc(db, 'artifacts', artifactAppId, 'public', 'data', 'tadarus_data', i.toString());
                     setDoc(juzukRef, { participants: [] });
                 }
            } else {
                juzukData = {};
                localStorage.removeItem('tadarus_data_v2');
                renderList();
            }
            showToast("Data diset semula.");
        }

        // --- UI Rendering ---

        function renderList() {
            const container = document.getElementById('juzukContainer');
            container.innerHTML = '';
            
            const daysLeft = getDaysRemaining();
            document.getElementById('daysRemainingBadge').innerText = `${daysLeft} Hari Lagi`;
            document.getElementById('targetDateDisplay').innerText = `Sasaran: 6 Mac 2026`;

            let totalParticipants = 0;
            let totalDone = 0;

            for (let i = 1; i <= 30; i++) {
                const data = juzukData[i.toString()] || { participants: [] };
                const participants = data.participants || [];
                
                totalParticipants += participants.length;
                const doneInJuz = participants.filter(p => p.status === 'done').length;
                totalDone += doneInJuz;
                const isJuzukComplete = participants.length > 0 && doneInJuz === participants.length;

                const card = document.createElement('div');
                card.className = `bg-white p-4 rounded-xl card-shadow border-l-4 transition-all mb-3 ${isJuzukComplete ? 'border-green-500 bg-green-50/50' : 'border-emerald-500'}`;
                
                const juzName = juzukNames[i-1];
                const totalAyat = juzukVersesCount[i-1];
                
                // --- LOGIK PEMBAHAGIAN AYAT ---
                // 1. Kira berapa orang peserta dalam Juz ini (jika 0, anggap 1 orang untuk kiraan dasar)
                const activeParticipants = participants.length > 0 ? participants.length : 1;
                
                // 2. Bahagi jumlah ayat mengikut jumlah peserta
                // Cth: 150 ayat / 2 orang = 75 ayat seorang
                const ayatPerPersonTotal = Math.ceil(totalAyat / activeParticipants);
                
                // 3. Bahagi beban setiap orang dengan jumlah hari yang tinggal
                // Cth: 75 ayat / 10 hari = 7.5 (8) ayat sehari
                const ayatPerDay = daysLeft > 0 ? Math.ceil(ayatPerPersonTotal / daysLeft) : ayatPerPersonTotal;

                // Teks Tambahan untuk UI
                let splitInfoText = '';
                if (participants.length > 1) {
                    splitInfoText = `
                        <div class="mt-1 text-[10px] text-emerald-600 bg-emerald-100/50 px-2 py-1 rounded inline-block">
                            <i class="fas fa-users mr-1"></i> Dikongsi ${participants.length} orang (${ayatPerPersonTotal} ayat/seorang)
                        </div>
                    `;
                }

                const progressNote = isJuzukComplete 
                    ? `<div class="bg-green-50 p-2 rounded-lg border border-green-100 mb-2 flex items-center gap-2">
                        <i class="fas fa-check-circle text-green-500 text-xl"></i>
                        <div>
                            <p class="text-xs font-bold text-green-700">Juzuk Selesai</p>
                        </div>
                     </div>`
                    : `<div class="bg-blue-50/80 p-3 rounded-lg border border-blue-100 mb-2">
                        <div class="flex flex-col">
                            <div class="flex justify-between items-baseline">
                                <span class="text-[10px] text-blue-600 uppercase font-bold tracking-wide">Target Harian Anda</span>
                                <span class="text-[10px] text-gray-400">Total Juz: ${totalAyat} ayat</span>
                            </div>
                            <div class="flex items-end gap-1 mt-1">
                                <span class="text-2xl font-bold text-blue-700 leading-none">${ayatPerDay}</span>
                                <span class="text-xs text-blue-600 font-medium mb-0.5">ayat / hari</span>
                            </div>
                            ${splitInfoText}
                        </div>
                     </div>`;

                let participantsHtml = '';
                if (participants.length > 0) {
                    participantsHtml = `<div class="mt-3 space-y-2">`;
                    participants.forEach(p => {
                        const isDone = p.status === 'done';
                        participantsHtml += `
                            <div class="flex items-center justify-between bg-gray-50 rounded-lg p-2 border border-gray-100 group">
                                <div class="flex items-center gap-3">
                                    <button onclick="toggleStatus(${i}, '${p.ic}', '${p.status}')" 
                                        class="w-6 h-6 rounded flex items-center justify-center transition-colors ${isDone ? 'bg-green-500 text-white' : 'bg-white border border-gray-300 text-gray-300 hover:border-green-400'}">
                                        ${isDone ? '<i class="fas fa-check text-xs"></i>' : ''}
                                    </button>
                                    <div class="flex flex-col">
                                        <span class="text-sm font-semibold text-gray-800 ${isDone ? 'line-through text-gray-400' : ''}">${p.name}</span>
                                    </div>
                                </div>
                                <button onclick="removeParticipant(${i}, '${p.ic}', '${p.name}')" class="text-gray-300 hover:text-red-500 p-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    });
                    participantsHtml += `</div>`;
                } else {
                    participantsHtml = `<div class="mt-2 text-xs text-gray-400 italic">Belum ada peserta.</div>`;
                }

                card.innerHTML = `
                    <div class="flex items-start gap-3">
                        <div class="flex flex-col items-center justify-center w-14 text-center pt-1">
                            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Juz</span>
                            <span class="text-xl font-bold text-emerald-700 font-arabic leading-none">${i}</span>
                        </div>
                        
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-[10px] font-semibold text-emerald-600 uppercase tracking-wide truncate pr-2">${juzName}</div>
                                <button onclick="openRegistrationModal(${i})" class="shrink-0 text-xs bg-emerald-100 hover:bg-emerald-200 text-emerald-700 px-2 py-1 rounded-full font-medium transition-colors">
                                    <i class="fas fa-plus mr-1"></i> Tambah
                                </button>
                            </div>
                            
                            ${progressNote}
                            
                            ${participantsHtml}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            }
            updateProgress(totalDone, totalParticipants);
        }

        function updateProgress(done, total) {
            const percentage = total > 0 ? Math.round((done / total) * 100) : 0;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('completedCount').innerText = `${done} Selesai dibaca`;
        }

        // --- Helpers ---
        function openRegistrationModal(juz) {
            currentJuzukSelection = juz;
            document.getElementById('modalJuzInfo').innerText = `Juzuk ${juz} (${juzukNames[juz-1]}) - ${juzukVersesCount[juz-1]} Ayat`;
            document.getElementById('modalIC').value = '';
            document.getElementById('modalName').value = '';
            document.getElementById('icFeedback').innerHTML = '';
            document.getElementById('nameInputContainer').classList.add('hidden');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('authModal').classList.remove('hidden');
            setTimeout(() => document.getElementById('modalIC').focus(), 100);
        }

        function closeModal() {
            document.getElementById('authModal').classList.add('hidden');
            currentJuzukSelection = null;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = message;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        function copyToWhatsapp() {
            const daysLeft = getDaysRemaining();
            let text = `*TADARUS BULAN RAMADHAN, PPD MIRI* ðŸŒ™\n`;
            text += `_Sasaran Khatam: 6 Mac 2026 (${daysLeft} Hari Lagi)_\n\n`;
            
            let emptyJuzuks = 0;

            for (let i = 1; i <= 30; i++) {
                const data = juzukData[i.toString()] || { participants: [] };
                const list = data.participants || [];
                const juzName = juzukNames[i-1];
                
                if (list.length === 0) {
                    text += `â¬œ Juz ${i}: _(Kosong)_\n`;
                    emptyJuzuks++;
                } else {
                    text += `ðŸ”¹ Juz ${i}:\n`;
                    list.forEach(p => {
                        const icon = p.status === 'done' ? 'âœ…' : 'ðŸ“–';
                        text += `    ${icon} ${p.name}\n`;
                    });
                }
            }

            text += `\nðŸ“Š *Info:* ${emptyJuzuks} Juzuk masih kosong.\nMohon sertai kami untuk memeriahkan bulan Al-Quran. Terima kasih!`;

            navigator.clipboard.writeText(text).then(() => {
                showToast("Senarai disalin ke clipboard!");
            }).catch(err => {
                showToast("Gagal menyalin.");
            });
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;500;600&display=swap');
        
        body { font-family: 'Poppins', sans-serif; background-color: #f0fdf4; }
        .font-arabic { font-family: 'Amiri', serif; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .modal-enter { animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes modalPop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-emerald-50 min-h-screen pb-24">

    <!-- Header -->
    <div class="bg-emerald-700 text-white p-6 rounded-b-3xl shadow-lg sticky top-0 z-10">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h1 class="text-xl md:text-2xl font-bold"><i class="fas fa-quran mr-2"></i> Tadarus Ramadhan</h1>
                    <span class="text-xs bg-emerald-800 px-2 py-1 rounded-full border border-emerald-500 text-center leading-tight">PPD Miri</span>
                </div>
                <div id="modeIndicator"></div>
            </div>
            
            <!-- Countdown Banner -->
            <div class="flex justify-between items-center bg-emerald-800/50 rounded-lg p-2 mb-4 border border-emerald-600/30">
                <div>
                    <p class="text-[10px] text-emerald-200 uppercase tracking-wider" id="targetDateDisplay">Sasaran: ...</p>
                    <p class="text-sm font-bold text-white"><i class="far fa-hourglass mr-1"></i> <span id="daysRemainingBadge">...</span></p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-emerald-200">Tips:</p>
                    <p class="text-[10px] italic">"Istiqomah sedikit demi sedikit"</p>
                </div>
            </div>

            <p class="text-emerald-100 text-xs md:text-sm mb-4 italic leading-relaxed hidden">"Bacalah Al-Quran, sesungguhnya ia akan datang pada hari kiamat sebagai pemberi syafaat kepada pembacanya."</p>
            
            <!-- Progress Bar -->
            <div class="w-full bg-emerald-900 rounded-full h-2.5 mb-1">
                <div id="progressBar" class="bg-yellow-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-xs text-emerald-100">
                <span id="completedCount">0 Selesai</span>
            </div>
        </div>
    </div>

    <!-- Main List Container -->
    <div class="max-w-md mx-auto p-4 space-y-3" id="juzukContainer">
        <!-- Loading State -->
        <div class="text-center py-10 text-gray-400">
            <i class="fas fa-circle-notch fa-spin fa-2x mb-2"></i>
            <p>Sedang memuatkan data...</p>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-100 z-20">
        <div class="max-w-md mx-auto flex gap-2">
            <button onclick="copyToWhatsapp()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl shadow-md transition transform active:scale-95 flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-xl"></i> Salin List
            </button>
            <button onclick="clearAllData()" class="bg-red-50 hover:bg-red-100 text-red-600 font-medium py-3 px-4 rounded-xl transition transform active:scale-95">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </div>

    <!-- SPARK Style Registration Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 relative modal-enter">
            
            <!-- Modal Header -->
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                    <i class="fas fa-search text-lg"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800">Carian Peserta</h3>
                    <p class="text-xs text-emerald-600 font-medium" id="modalJuzInfo">...</p>
                </div>
                <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Step 1: Input IC -->
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wider">No. Kad Pengenalan / ID</label>
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <i class="fas fa-id-card absolute left-3 top-3 text-gray-400"></i>
                            <input type="tel" id="modalIC" class="w-full pl-10 pr-4 py-2 border-2 border-gray-100 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-sm font-medium" placeholder="Cth: 900101123456">
                        </div>
                        <button onclick="checkIC()" class="bg-emerald-100 text-emerald-700 px-4 rounded-xl font-bold hover:bg-emerald-200 transition-colors">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div id="icFeedback" class="mt-2 min-h-[20px]"></div>
                </div>

                <!-- Step 2: Name (Hidden until IC Checked) -->
                <div id="nameInputContainer" class="hidden animate-fade-in-down">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wider">Nama Penuh</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="modalName" class="w-full pl-10 pr-4 py-2 border-2 border-gray-100 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-sm font-medium" placeholder="Nama akan muncul di sini">
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 mt-8">
                <button onclick="closeModal()" class="flex-1 bg-gray-100 text-gray-600 font-semibold py-2.5 rounded-xl hover:bg-gray-200 transition-colors text-sm">Batal</button>
                <button id="submitBtn" onclick="confirmRegistration()" disabled class="flex-1 bg-emerald-600 text-white font-semibold py-2.5 rounded-xl hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-200 text-sm opacity-50 cursor-not-allowed">
                    Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-sm flex items-center gap-2">
        <i class="fas fa-check-circle text-green-400"></i> <span id="toastMsg">Disalin!</span>
    </div>

</body>
</html>
