<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senarai Tadarus Ramadan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0fdf4; /* Light green bg */
        }
        .font-arabic {
            font-family: 'Amiri', serif;
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .modal-enter {
            animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body class="bg-emerald-50 min-h-screen pb-24">

    <!-- Header -->
    <div class="bg-emerald-700 text-white p-6 rounded-b-3xl shadow-lg sticky top-0 z-10">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-center mb-2">
                <h1 class="text-2xl font-bold"><i class="fas fa-quran mr-2"></i> Tadarus Ramadan</h1>
                <span class="text-xs bg-emerald-800 px-2 py-1 rounded-full border border-emerald-500">1446H</span>
            </div>
            <p class="text-emerald-100 text-sm mb-4">Pilih Juzuk untuk mendaftar penyertaan.</p>
            
            <!-- Progress Bar -->
            <div class="w-full bg-emerald-900 rounded-full h-2.5 mb-1">
                <div id="progressBar" class="bg-yellow-400 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-xs text-emerald-100">
                <span id="completedCount">0/30 Selesai</span>
                <span id="percentCount">0%</span>
            </div>
        </div>
    </div>

    <!-- Main List Container -->
    <div class="max-w-md mx-auto p-4 space-y-3" id="juzukContainer">
        <!-- Javascript will populate this -->
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] border-t border-gray-100 z-20">
        <div class="max-w-md mx-auto flex gap-2">
            <button onclick="copyToWhatsapp()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl shadow-md transition transform active:scale-95 flex items-center justify-center gap-2">
                <i class="fab fa-whatsapp text-xl"></i> Salin List
            </button>
            <button onclick="clearData()" class="bg-red-100 hover:bg-red-200 text-red-600 font-medium py-3 px-4 rounded-xl transition transform active:scale-95">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 relative modal-enter">
            
            <!-- Modal Header -->
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                    <i class="fas fa-user-plus text-lg"></i>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-800">Daftar Peserta</h3>
                    <p class="text-xs text-emerald-600 font-medium" id="modalJuzInfo">Juzuk ...</p>
                </div>
                <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Form -->
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wider">Nama Penuh</label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="modalName" class="w-full pl-10 pr-4 py-2 border-2 border-gray-100 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-sm font-medium" placeholder="Cth: Ahmad Albab">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1 tracking-wider">No. Kad Pengenalan</label>
                    <div class="relative">
                        <i class="fas fa-id-card absolute left-3 top-3 text-gray-400"></i>
                        <input type="tel" id="modalIC" class="w-full pl-10 pr-4 py-2 border-2 border-gray-100 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-sm font-medium" placeholder="Cth: 900101123456">
                    </div>
                    <p class="text-[10px] text-gray-400 mt-2 bg-gray-50 p-2 rounded border border-gray-100">
                        <i class="fas fa-lock text-xs mr-1"></i> Data IC disimpan secara lokal dan tidak akan dipaparkan di WhatsApp.
                    </p>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 mt-8">
                <button onclick="closeAuthModal()" class="flex-1 bg-gray-100 text-gray-600 font-semibold py-2.5 rounded-xl hover:bg-gray-200 transition-colors text-sm">Batal</button>
                <button onclick="saveParticipant()" class="flex-1 bg-emerald-600 text-white font-semibold py-2.5 rounded-xl hover:bg-emerald-700 transition-colors shadow-lg shadow-emerald-200 text-sm">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-sm flex items-center gap-2">
        <i class="fas fa-check-circle text-green-400"></i> <span id="toastMsg">Disalin!</span>
    </div>

    <script>
        // Data Juzuk Names
        const juzukNames = [
            "Alif Lam Mim", "Sayaqulu", "Tilka Rusul", "Lan Tanalu", "Wal Muhsanat", 
            "La Yuhibbullah", "Wa Iza Samiu", "Wa Lau Annana", "Qalal Malao", "Wa A'lamu",
            "Ya'tazeruna", "Wa Ma Min Dabbah", "Wa Ma Ubarri'u", "Rubama", "Subhanallazi",
            "Qala Alam", "Iqtaraba", "Qad Aflaha", "Wa Qalallazina", "Amman Khalaqa",
            "Utlu Ma Uhiya", "Wa Man Yaqnut", "Wa Maliya", "Faman Azlamu", "Ilaihi Yuraddu",
            "Ha Mim", "Qala Fama Khatbukum", "Qad Sami'allah", "Tabarakallazi", "'Amma Yatasa'alun"
        ];

        // Initialize Data
        const totalJuzuk = 30;
        let tadarusData = JSON.parse(localStorage.getItem('tadarusData')) || {};
        let currentJuzInModal = null;

        const container = document.getElementById('juzukContainer');

        // Function to render the list
        function renderList() {
            container.innerHTML = '';
            let completed = 0;

            for (let i = 1; i <= totalJuzuk; i++) {
                // Ensure data object structure
                const data = tadarusData[i] || { name: '', ic: '', done: false };
                if (data.done) completed++;

                const card = document.createElement('div');
                const isTaken = data.name && data.name.trim() !== '';
                
                card.className = `bg-white p-4 rounded-xl card-shadow flex items-center gap-3 border-l-4 transition-all ${data.done ? 'border-green-500 bg-green-50' : (isTaken ? 'border-emerald-500' : 'border-gray-200')}`;
                
                // Get Juz Name (Index is i-1 because array starts at 0)
                const juzName = juzukNames[i-1];

                card.innerHTML = `
                    <div class="flex flex-col items-center justify-center w-14 text-center">
                        <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Juz</span>
                        <span class="text-xl font-bold ${isTaken ? 'text-emerald-700' : 'text-gray-400'} font-arabic leading-none">${i}</span>
                    </div>
                    
                    <div class="flex-1 min-w-0">
                        <div class="text-[10px] font-semibold ${isTaken ? 'text-emerald-600' : 'text-gray-400'} uppercase tracking-wide mb-1">${juzName}</div>
                        
                        ${isTaken ? 
                            `<div class="flex items-center justify-between py-1">
                                <span class="text-sm font-semibold text-gray-800 truncate">${data.name}</span>
                                <button onclick="clearSlot(${i})" class="text-gray-300 hover:text-red-500 transition-colors p-1" title="Padam Nama">
                                    <i class="fas fa-times-circle"></i>
                                </button>
                             </div>` 
                            : 
                            `<div onclick="openAuthModal(${i})" class="w-full border-b border-dashed border-gray-300 py-1 text-emerald-600/60 hover:text-emerald-600 text-sm cursor-pointer transition-colors italic hover:border-emerald-400 flex items-center gap-2">
                                <i class="fas fa-plus-circle text-xs"></i> Tekan untuk daftar...
                             </div>`
                        }
                    </div>

                    <div class="flex items-center pl-2 border-l border-gray-100 ml-1">
                        <label class="cursor-pointer relative p-1" title="Tanda Selesai">
                            <input type="checkbox" 
                                class="w-6 h-6 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500 cursor-pointer accent-emerald-600"
                                ${data.done ? 'checked' : ''}
                                ${!isTaken ? 'disabled' : ''}
                                onchange="toggleDone(${i}, this.checked)">
                        </label>
                    </div>
                `;
                container.appendChild(card);
            }
            updateProgress(completed);
        }

        // --- MODAL FUNCTIONS ---

        function openAuthModal(juz) {
            currentJuzInModal = juz;
            document.getElementById('modalJuzInfo').innerText = `Juzuk ${juz}: ${juzukNames[juz-1]}`;
            document.getElementById('modalName').value = '';
            document.getElementById('modalIC').value = '';
            document.getElementById('authModal').classList.remove('hidden');
            
            // Focus on name input
            setTimeout(() => document.getElementById('modalName').focus(), 100);
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
            currentJuzInModal = null;
        }

        function saveParticipant() {
            const name = document.getElementById('modalName').value.trim();
            const ic = document.getElementById('modalIC').value.trim();

            if (!name) {
                alert("Sila masukkan Nama Penuh.");
                return;
            }
            if (!ic) {
                alert("Sila masukkan No. Kad Pengenalan.");
                return;
            }

            // Save Data
            if (!tadarusData[currentJuzInModal]) tadarusData[currentJuzInModal] = { done: false };
            tadarusData[currentJuzInModal].name = name;
            tadarusData[currentJuzInModal].ic = ic;
            
            saveData();
            closeAuthModal();
            renderList();
            showToast(`Juzuk ${currentJuzInModal} berjaya didaftarkan!`);
        }

        function clearSlot(juz) {
            if(confirm("Adakah anda pasti mahu memadam nama peserta ini?")) {
                tadarusData[juz].name = "";
                tadarusData[juz].ic = "";
                tadarusData[juz].done = false;
                saveData();
                renderList();
            }
        }

        // --- CORE FUNCTIONS ---

        function toggleDone(juz, isDone) {
            if (!tadarusData[juz]) tadarusData[juz] = { name: '', ic: '', done: false };
            tadarusData[juz].done = isDone;
            saveData();
            renderList();
        }

        function saveData() {
            localStorage.setItem('tadarusData', JSON.stringify(tadarusData));
            
            let completed = 0;
            for(let i=1; i<=30; i++) {
                if(tadarusData[i] && tadarusData[i].done) completed++;
            }
            updateProgress(completed);
        }

        function updateProgress(count) {
            const percentage = Math.round((count / totalJuzuk) * 100);
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('completedCount').innerText = `${count}/${totalJuzuk} Selesai`;
            document.getElementById('percentCount').innerText = `${percentage}%`;
        }

        function copyToWhatsapp() {
            let text = "*SENARAI TADARUS RAMADAN 1446H* ðŸŒ™\n\n";
            let openSlots = 0;

            for (let i = 1; i <= totalJuzuk; i++) {
                const data = tadarusData[i] || { name: '', done: false };
                const statusIcon = data.done ? "âœ…" : "â¬œ";
                // Only show name, hide IC for privacy
                const nameDisplay = (data.name && data.name.trim()) ? `*${data.name}*` : "_(Kosong)_";
                const juzName = juzukNames[i-1];
                
                if (!data.name || !data.name.trim()) openSlots++;

                text += `${statusIcon} Juz ${i} (${juzName}): ${nameDisplay}\n`;
            }

            text += `\nðŸ“Š *Status:* ${openSlots} lagi kekosongan.\nSila tekan link untuk daftar nama & pilih Juzuk. Terima kasih!`;

            navigator.clipboard.writeText(text).then(() => {
                showToast("Senarai disalin! Boleh paste di WhatsApp.");
            }).catch(err => {
                showToast("Gagal menyalin. Sila cuba lagi.");
            });
        }

        function clearData() {
            if(confirm("AWAS: Adakah anda pasti mahu memadam SEMUA rekod dan nama? Tindakan ini tidak boleh dikembalikan.")) {
                tadarusData = {};
                localStorage.removeItem('tadarusData');
                renderList();
                showToast("Semua data telah dipadam.");
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = message;
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 3000);
        }

        // Close modal on click outside
        document.getElementById('authModal').addEventListener('click', (e) => {
            if (e.target.id === 'authModal') closeAuthModal();
        });

        // Initial Render
        renderList();

    </script>
</body>
</html>
